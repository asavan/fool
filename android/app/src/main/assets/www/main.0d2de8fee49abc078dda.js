(()=>{"use strict";var e,t,n={541:(e,t,n)=>{n.d(t,{A:()=>r});const r=function(e,t){return{move:n=>(t.log("onMove",n),e.onMove(n.playerIndex,n.card,n.currentColor)),draw:n=>(t.log("onDraw",n),e.onDraw(n.playerIndex,n.card))}}},911:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(541);const a=function(e,t){return Object.assign({},(0,r.A)(e,t),{pass:n=>(t.log("on pass",n),e.pass(n.playerIndex)),changeCurrent:()=>function(e){e.error("Should Not Happen")}(t)})}},217:(e,t,n)=>{function r(e,t){if(!e)throw t}n.d(t,{v:()=>r})},746:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(217);function a(e){const t={};for(const n of e)t[n]=[];const n=e=>{const n=t[e];return(0,r.v)(Array.isArray(n),"No key "+e),n};return{on:(e,t)=>n(e).push(t),set:(e,n)=>t[e]=n,setOnce:(e,n)=>{t[e]=[n]},call:(e,t)=>{const r=[];for(const a of n(e))"function"==typeof a&&r.push(a(t));return Promise.all(r)},reset:e=>{t[e]=[]},actionKeys:()=>Object.keys(t)}}},272:(e,t,n)=>{n.d(t,{A:()=>r});const r={makeId:function(e,t){let n="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let a=0;a<e;a++)n+=r.charAt(Math.floor(62*t()));return n},randomEl:function(e,t){return e[Math.floor(t()*e.length)]},randomInteger:function(e,t,n){const r=e+n()*(t-e);return Math.floor(r)}}},158:(e,t,n)=>{n.d(t,{c:()=>r});const r=e=>new Promise((t=>setTimeout(t,e)))},42:(e,t,n)=>{function r(e,t,n){const r=e=>{t&&("object"==typeof e&&JSON&&JSON.stringify?t.innerHTML+=JSON.stringify(e)+"<br />":t.innerHTML+=e+"<br />")};return{log:(t,...a)=>{e<n.logLevel||r(t)},error:(t,...a)=>{e>=n.logLevel&&r(t)}}}n.d(t,{A:()=>r})}},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return n[e](o,o.exports,a),o.exports}a.m=n,a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,n)=>(a.f[n](e,t),t)),[])),a.u=e=>e+"."+{111:"b18fbb8174b3353df553",249:"6f6b3db364101d63dbeb",251:"24dbb0919ab2f3d7b789",433:"ab70fce1eef5b7148bb4",641:"5bf842ea05f649b56d32",659:"139962b7d83a65e4f64c",666:"7ddb6374d5b19130a7c5",723:"115574f36cfa83cf5c81",998:"77432f24c685bfcc8e60"}[e]+".js",a.miniCssF=e=>{},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="suno:",a.l=(n,r,o,c)=>{if(e[n])e[n].push(r);else{var l,s;if(void 0!==o)for(var i=document.getElementsByTagName("script"),d=0;d<i.length;d++){var u=i[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+o){l=u;break}}l||(s=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",t+o),l.src=n),e[n]=[r];var f=(t,r)=>{l.onerror=l.onload=null,clearTimeout(g);var a=e[n];if(delete e[n],l.parentNode&&l.parentNode.removeChild(l),a&&a.forEach((e=>e(r))),t)return t(r)},g=setTimeout(f.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=f.bind(null,l.onerror),l.onload=f.bind(null,l.onload),s&&document.head.appendChild(l)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={792:0};a.f.j=(t,n)=>{var r=a.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,a)=>r=e[t]=[n,a]));n.push(r[2]=o);var c=a.p+a.u(t),l=new Error;a.l(c,(n=>{if(a.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),c=n&&n.target&&n.target.src;l.message="Loading chunk "+t+" failed.\n("+o+": "+c+")",l.name="ChunkLoadError",l.type=o,l.request=c,r[1](l)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,o,[c,l,s]=n,i=0;if(c.some((t=>0!==e[t]))){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(s)s(a)}for(t&&t(n);i<c.length;i++)o=c[i],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0},n=self.webpackChunksuno=self.webpackChunksuno||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{const e={modes:["net","ai","server","hotseat"],mode:"net",connections:["webrtc","websocket"],connection:"websocket",wsPort:8088,loggerAnchor:".log",passAnchor:"",logLevel:7,cardsDeal:7,botCount:2,playerIsBot:!1,idNameInStorage:"my-id",idNameLen:6,maxClickToBan:5,maxScore:500,showAll:!1,clickAll:!1,show:!0,applyEffects:!0,lastCardNoColor:!0,legacyView:!1,chooseDealer:!0,colorOrder:["red","yellow","green","blue","black"],sortByColor:"",direction:["center"],seed:"",highlight:"aftermove",highlightDelay:1e3,movePause:150,botMovePause:700,botSecondMovePause:300,dealAnim:500,discardAnimBeforeFlip:100,discardAnimAfterFlip:800,betweenRounds:900,beforeChooseDealer:100,drawShow:200,drawMy:120,drawClosed:50,beforeDeal:100,shufflePause:300,changeCurrentPause:50,moveAnim:250,moveOtherAnim:190,shuffleOutDelay:150,shuffleInDelay:150,shuffleWaitDelay:200,shuffleSmallDelay:10,shuffleTimes:2,shuffleMaxCardsShow:20,maxNameLen:15};function t(e,t,n,r){const a=t.querySelector(".name-form-cont"),o=e.sessionStorage.getItem("username"),c=e=>{r&&"function"==typeof r&&r(e)};if(o)return a.replaceChildren(),void c(o);const l=t.querySelector("#nameform").content.cloneNode(!0).firstElementChild;a.replaceChildren(l);const s=t.querySelector(".nameform"),i=t.querySelector(".nameinput"),d=t.querySelector(".container");function u(t){(function(e){return!(e.length>n.maxNameLen&&(alert("Choose shorter name!"),1))})(i.value)&&(e.sessionStorage.setItem("username",t),c(t),s.classList.add("hidden"),d.classList.remove("hidden"),a.replaceChildren())}"net"===n.mode&&d.classList.add("hidden"),s.addEventListener("submit",(function(e){e.preventDefault(),u(i.value)}))}var n=a(42),r=a(217),o=a(158);function c(e,t,n){let r=e;function a(){return function(e,t){for(let n=e.length-1;n>0;n--){const r=Math.floor(t()*(n+1)),a=e[n];e[n]=e[r],e[r]=a}}(r,n),t(r)}return{deal:function(){return r.pop()},addCardAndShuffle:function(e){return function(e){r.push(e)}(e),a()},setDeck:function(e){r=e},checkTop:function(e){if(0===r.length)return!1;const t=r.at(-1)===e;return t},size:()=>r.length,shuffle:a,topCard:function(){if(0!==r.length)return r.at(-1)},toJson:()=>[...r]}}const l={newShuffledDeck:async function(e,t){const n=c(function(){const e=[...Array(112).keys()];return e.splice(56,1),e.splice(69,1),e.splice(82,1),e.splice(95,1),e}(),e,t);return await n.shuffle(),n},newExternalDeck:c},s=Object.freeze(["red","yellow","green","blue"]),i="black",d=Object.freeze({CHOOSE_DEALER:1,DEALING:2,ROUND:3,ROUND_OVER:4,GAME_OVER:5});function u(e){let t;if(e%14==13)return"black";switch(Math.floor(e/14)){case 0:case 4:t="red";break;case 1:case 5:t="yellow";break;case 2:case 6:t="green";break;case 3:case 7:t="blue"}return t}function f(e){switch(e%14){case 10:return"Skip";case 11:return"Reverse";case 12:return"Draw2";case 13:return Math.floor(e/14)>=4?"Draw4":"Wild";default:return"Number "+e%14}}function g(e){let t;switch(e%14){case 10:case 11:case 12:t=20;break;case 13:t=50;break;default:t=e%14}return t}function p(e,t,n){return u(e)===n||f(e)===f(t)}const y={GOOD_COLORS:s,BLACK_COLOR:i,GameStage:d,cardColor:u,cardType:f,cardScore:g,sortByTemplate:function(e,t,n){const r="asc"===t?1:-1;e.sort(((e,t)=>{const a=u(e),o=u(t);if(a===o){const n=g(e)-g(t);return 0===n?(e-t)*r:n*r}for(const e of n){if(e===a)return-1;if(e===o)return 1}return 0}))},pileHasColor:function(e,t){return null!=e.find((e=>u(e)===t))},cardToString:function(e){return u(e)+" "+f(e)},suitable:function(e,t,n,r){return"Wild"===f(e)||("Draw4"===f(e)?!r:p(e,t,n))},sameColorOrTypeNonBlack:function(e,t,n){return u(e)!==i&&p(e,t,n)},isDrawCard:function(e){return"Draw4"===f(e)||"Draw2"===f(e)},nextPlayer:function(e,t,n,r){return(r+(e+1)*n+t)%t},matchColor:function(e,t){return!!s.includes(t)&&(u(e)===t||u(e)===i)}};function h(e,t,n){const r=t,a=[...e];let o=n||0;const c=()=>[...a];return{toJson:()=>({score:o,pile:c()}),addCard:e=>a.push(e),pile:c,isUno:()=>1===a.length,getIndex:()=>r,cleanHand:()=>{a.length=0},removeCard:e=>{const t=a.indexOf(e);return t<0||a.splice(t,1),t},updateScore:e=>{o+=e},getScore:()=>o,setScore:e=>{o=e},hasEmptyHand:()=>0===a.length,hasColor:e=>y.pileHasColor(a,e),hasCard:e=>a.includes(e)}}var m=a(746);const C=async function({players:e,logger:t,dealToPlayer:n,dealer:a,deck:o,direction:c}){let l=[...e];for(;l.length>1;){const e=l.length,s=new Array(e);let i=0;for(let d=0;d<e;d++){const u=y.nextPlayer(d,e,c,a),f=l[u].getIndex(),g=await n(o,f);(0,r.v)(void 0!==g);const p=y.cardScore(g);t.log(">> Player "+d+" draws "+y.cardToString(g)+" and gets "+p+" points"),s[u]=p,i=Math.max(i,p)}const d=[];for(let t=0;t<e;t++)s[t]===i&&d.push(l[t]);l=d}return l.length>=1?a=l[0].getIndex():t.error("No cand",l),a};function w({settings:e,rngFunc:t,applyEffects:n,delay:r},{logger:a,traceLogger:o,debugLogger:c},{playersRaw:s,dealer:i,direction:d,deckRaw:u,discardPile:f,currentPlayer:g,cardTaken:p,cardDiscarded:w,maxScore:v,gameState:S,cardOnBoard:x,currentColor:b}){const E=v,L=function(e){return(t,n)=>{if(!t)throw e.error(n),n}}(a),D=(0,m.A)(["shuffle","shuffleFake","draw","discard","discardExternal","move","clearPlayer","clearPlayerExternal","changeCurrent","changeCurrentExternal","changeDealer","gameover","roundover","pass","drawExternal","moveExternal"]);function O(e,t){return"changeCurrent"!==e||n||a.error("try to change current without effect"),D.call(e,t)}const I=e=>O("shuffle",e),k=s.map(((e,t)=>h(e.pile,t,e.score)));let P=l.newExternalDeck(u,I,t),A=q;function q(){return b}function B(e,t,n){return y.nextPlayer(0,t,n,e)}function R(){const e=f.pop();return P.setDeck(f),f=[e],P.shuffle()}async function N(e,t,r){if(null==e||0===e.size())return void a.error("deck is empty");const o=e.deal();if(null!=o)return k[t].addCard(o),r?await O("drawExternal",{playerIndex:t,card:o}):await O("draw",{playerIndex:t,card:o}),0===e.size()&&n&&(a.log("reshuffle discard"),await R()),o;a.error("deck is empty, should never happen")}function T(){return{[Symbol.iterator](){let e=0;return{next:()=>e>=k.length?{done:!0,value:e}:{done:!1,value:k[e++]},return:()=>(a.log("Closing"),{done:!0})}}}}async function M(){x=void 0,f=[];const e=[];for(const t of k)t.cleanHand(),e.push(O("clearPlayer",t.getIndex()));await Promise.all(e)}function G(){g=B(g,k.length,d),p=0,w=0}async function _(e,t){L(t===g);const n=y.cardType(e);if(o.log("calcCardEffect",{playerIndex:t,card:e},y.cardToString(e)),"Reverse"===n&&(d*=-1,2===k.length&&G()),"Skip"===n&&G(),"Draw2"===n){G();for(let e=0;e<2;++e)await N(P,g)}if("Draw4"===n){G();for(let e=0;e<4;++e)await N(P,g)}await J()}async function H(e){L(e*k.length<P.size(),"Not enought cards to play");for(let t=0;t<e;++t){const e=k.length;for(let t=0;t<e;t++){const n=y.nextPlayer(t,e,d,i),r=k[n].getIndex();await N(P,r)}}g!==i&&(a.error("dealN",W()),g=i,await O("changeCurrent",W()));const t=await async function(e){let t=e.deal();for(x=t;y.cardColor(t)===y.BLACK_COLOR;)await O("discard",t),x=void 0,await e.addCardAndShuffle(t),t=e.deal(),x=t;return f.push(t),b=y.cardColor(t),c.log("dealToDiscardEnd",W()),await O("discard",t),t}(P);await _(t,g),S=y.GameStage.ROUND}function j(){return k[g]}async function U(t,n){if(t!==g)return a.log("Wrong player",g,t),!1;if(!j().hasCard(n))return a.error("player not has card"),!1;if(S!==y.GameStage.ROUND)return a.log("start new round"),!1;if(w>0)return a.log("already moved"),!1;if("Wild"===y.cardType(n)){if(e.lastCardNoColor&&j().isUno())return b;const n=await A(t);return y.GOOD_COLORS.includes(n)?n:(a.log("Wrong color",n),!1)}if("Draw4"===y.cardType(n)){if(j().hasColor(b))return!1;if(e.lastCardNoColor&&j().isUno())return b;const n=await A(t);return y.GOOD_COLORS.includes(n)?n:(a.log("Wrong color",n),!1)}return y.cardColor(n)===b?b:y.cardType(n)===y.cardType(x)?y.cardColor(n):(a.log("Bad card",y.cardType(n),y.cardType(x),b),!1)}function $(){let e=0;const t=T();for(const n of t)for(const t of n.pile())e+=y.cardScore(t);return e}async function z(e){const t=k[e];L(t.hasEmptyHand(),"End on not empty hand"),L(S!==y.GameStage.ROUND,"Bad state onRoundEnd");const n=$();t.updateScore(n);const r=t.getScore();r>=E?(S=y.GameStage.GAME_OVER,await O("gameover",{playerIndex:e,score:r,diff:n})):(S=y.GameStage.ROUND_OVER,await O("roundover",{playerIndex:e,score:r,diff:n}))}async function F(e,t,r){const o=function(e,t,n){return e!==g?(a.error("Wrong player",g,e),!1):j().hasCard(t)?y.matchColor(t,n)?S!==y.GameStage.ROUND?(a.log("start new round",W()),!1):w>0?(a.log("already moved"),!1):!!y.suitable(t,x,b,j().hasColor(b))||(a.error("Bad card",y.cardType(t),y.cardType(x),b),!1):(a.error("Wrong next color",n,t,y.cardToString(t)),L(!1,"Bad color"),!1):(a.error("player not has card"),!1)}(e,t,r);return o&&await async function(e,t,r){L(S===y.GameStage.ROUND,"Move on round end");const a=k[e];a.removeCard(t),x=t,f.push(t),b=r,++w,a.hasEmptyHand()&&(S=y.GameStage.ROUND_OVER),await O("move",{playerIndex:e,card:t,currentColor:b}),n&&(await _(t,g),S!==y.GameStage.ROUND_OVER&&S!==y.GameStage.GAME_OVER||await z(e))}(e,t,r),o}async function J(){return G(),await O("changeCurrent",W()),!0}function W(){return{currentPlayer:g,dealer:i,direction:d,currentColor:b,cardOnBoard:x,gameState:S}}return{isMyMove:e=>g===e&&S===y.GameStage.ROUND,canDraw:()=>p>0,getCurrentSuitable:()=>{const e=j(),t=e.hasColor(b);return e.pile().filter((e=>y.suitable(e,x,b,t)))},chooseDealer:async function(){S=y.GameStage.CHOOSE_DEALER,P=await l.newShuffledDeck(I,t),i=await C({players:k,logger:o,dealToPlayer:N,dealer:i,deck:P,direction:d}),await r(e.betweenRounds),await M(),g=i,S=y.GameStage.DEALING,await O("changeCurrent",W()),o.log("dealer was chosen",W())},deal:async function(){await M(),o.log("hands clean"),S=y.GameStage.DEALING,P=await l.newShuffledDeck(I,t),o.log("after cleanAllHands"),await H(e.cardsDeal),o.log("after dealN"),S=y.GameStage.ROUND,await O("changeCurrent",W())},getPlayerIterator:T,getPlayerByIndex:function(e){return k[e]},addPlayer:function(){return k.push(h(k.length)),!0},size:function(){return k.length},on:function(e,t){return D.on(e,t)},getDealer:function(){return i},getCurrentPlayer:function(){return g},getCardOnBoard:function(){return x},tryMove:U,moveToDiscard:async function(e,t){const n=await U(e,t);if(!1===n)return!1;const r=await F(e,t,n);return L(r,"Bad move"),r},setDeck:function(e){return null==P?P=l.newExternalDeck(e,I,t):P.setDeck(e),O("shuffleFake",e)},onDraw:async function(e,t){if(!P.checkTop(t))return a.error("Different engines"),!1;if(e!==g&&!y.isDrawCard(x)&&S!==y.GameStage.CHOOSE_DEALER&&S!==y.GameStage.DEALING)return a.error("draw not for current player",W()),!1;const n=await N(P,e,!0);return void 0===n?(a.error("onDraw bad"),!1):(o.log("onDraw",n,y.cardToString(n)),p++,!0)},onMove:async function(e,t,n){const r=await F(e,t,n);return r||a.log("Different engines"),r},onDiscard:async function(e){if(null==P||!P.checkTop(e))return void a.error("Different engines");const t=P.deal();L(t===e,"Different cards");const n=y.cardColor(e);n!==y.BLACK_COLOR?b=n:L(S!==y.GameStage.ROUND,"Black on discard in live round"),x=e,f.push(e),await O("discardExternal",e)},setCurrentObj:function(e){return p=0,w=0,L(void 0!==e.dealer,"No dealer"),L(void 0!==e.currentPlayer,"No currentPlayer"),L(e.direction,"No direction"),L(void 0!==e.gameState,"No gameState"),i=e.dealer,g=e.currentPlayer,d=e.direction,S=e.gameState,O("changeCurrentExternal",{})},cleanHandExternal:function(e){return x=void 0,f=[],k[e].cleanHand(),O("clearPlayerExternal",e)},nextDealer:function(){return d=1,i=B(i,k.length,d),g=i,S=y.GameStage.DEALING,O("changeCurrent",W())},onDrawPlayer:async function(e){if(e!==g)return a.log("draw not for current player",e,g),!1;if(S!==y.GameStage.ROUND)return a.log("onDrawPlayer bad state",W()),!1;if(p>0)return a.log("alreadyDrawn"),!1;const t=await N(P,g);return void 0===t?(a.error("onDrawPlayer bad"),!1):(p++,c.log("onDrawPlayer",t),null!=t)},pass:async function(e){return e!==g?(a.log("pass not for current player",e,g),!1):S!==y.GameStage.ROUND?(a.log("pass bad state",W()),!1):0==p?(a.error("cannot pass"),!1):(n?await J():await O("pass",{playerIndex:e}),!0)},getCurrentColor:q,getDirection:function(){return d},onEndRound:function(e){e.playerIndex!==g&&a.log("End not for current Player");const t=k[e.playerIndex];if(!t.hasEmptyHand())return a.error("End when not empty"),!1;const n=t.getScore();return e.score!==n+e.diff?(a.error("Bad score"),!1):$()!==e.diff?(a.error("Bad diff"),!1):(S=y.GameStage.ROUND_OVER,z(e.playerIndex))},deckSize:function(){return null==P?0:P.size()},secretlySeeTopCard:function(){if(null!=P)return P.topCard()},setColorChooser:e=>{A=e},toJson:()=>({playersRaw:k.map((e=>e.toJson())),deckRaw:P.toJson(),dealer:i,direction:d,discardPile:f,currentPlayer:g,gameState:S,cardTaken:p,cardDiscarded:w,maxScore:v,cardOnBoard:x,currentColor:b}),showAllCards:()=>S===y.GameStage.CHOOSE_DEALER,dealN:H}}function v(e,t,n,r){return n.setColorChooser((()=>function(e,t){return new Promise((n=>{t.inColorChoose=!0;const r=e.querySelector(".color-picker-holder");r.replaceChildren();const a=e.createElement("ul");a.classList.add("color-grid"),r.appendChild(a);for(const o of y.GOOD_COLORS){const c=e.createElement("li");c.classList.add(o),c.addEventListener("click",(e=>{e.preventDefault(),r.replaceChildren(),t.inColorChoose=!1,n(o)})),a.appendChild(c)}const o=e.createElement("li");o.classList.add("cancel-color"),o.addEventListener("click",(e=>{e.preventDefault(),r.replaceChildren(),t.inColorChoose=!1,n("black")})),a.appendChild(o)}))}(t,r))),{}}function S(e){const t=e.createElement("li");return t.classList.add("blank"),t}function x(e){return e.querySelector("#back").content.cloneNode(!0).firstElementChild}function b(e,t){return t.style.setProperty("--sprite-x",1400-e%14*100+"%"),t.style.setProperty("--sprite-y",800-100*Math.floor(e/14)+"%"),t.dataset.card=e,t}function E(e,t){return b(e,t.content.cloneNode(!0).firstElementChild)}function L(e,t,n,r){const a=e.createElement("ul"),o=e.querySelector("#card");a.classList.add("hand"),r&&r.sortByColor&&y.sortByTemplate(n,r.sortByColor,r.colorOrder);for(const e of n)a.appendChild(E(e,o));return t.appendChild(a),a}function D(e,t,n){!function(e,t,n,r,a){if(2===e||0===t)return;const o=n.querySelector("."+a);if(o){const e=o.querySelector(".direction");if(!e)return;return void(1===t?e.classList.add("mirror"):e.classList.remove("mirror"))}const c=r.createElement("span");c.classList.add(a);const l=r.createElement("div");l.classList.add("direction"),1===t&&l.classList.add("mirror"),c.appendChild(l),n.appendChild(c)}(n.size(),n.getDirection(),e,t,"big-circle")}function O({document:e,engine:t,settings:n,myIndex:r}){const a=e.querySelector(".places");let o=a.querySelector(".center-pile");o?o.replaceChildren():(o=e.createElement("div"),o.classList.add("center-pile"),a.appendChild(o));!function({document:e,parent:t,card:n,engine:r,clickAll:a,myIndex:o,settings:c}){const l=e.createElement("ul"),s=e.querySelector("#card");if(l.classList.add("hand"),null!=n){const e=E(n,s);l.appendChild(e),"card"===c.passAnchor&&(e.classList.add("clickable"),e.classList.add("js-pass"),e.addEventListener("click",(e=>{e.preventDefault();let t=o;return a&&(t=r.getCurrentPlayer()),r.pass(t)})))}else l.appendChild(S(e));if(0===r.deckSize())l.appendChild(S(e));else{const t=x(e);t.classList.add("js-draw"),c.passAnchor&&"deck"!==c.passAnchor||t.classList.add("js-pass"),t.addEventListener("click",(async e=>{e.preventDefault();let t=o;a&&(t=r.getCurrentPlayer()),await r.onDrawPlayer(t)||c.passAnchor&&"deck"!==c.passAnchor||await r.pass(t)})),l.appendChild(t)}t.appendChild(l)}({document:e,parent:o,card:t.getCardOnBoard(),engine:t,clickAll:n.clickAll,myIndex:r,settings:n})}function I(e){const t={green:"rgba(85, 170, 85, 0.4)",red:"rgba(255, 85, 85, 0.4)",yellow:"rgba(255, 170, 0, 0.4)",blue:"rgba(85, 85, 255, 0.4)"}[e];return null!=t?t:"rgba(240, 248, 255, 0.3)"}var k=a(272);const P=async function(e){const{document:t,settings:n,logger:r,length:a}={...e},c=t.querySelector(".center-pile");if(!c)return void r.log("No centerPile");const l=c.querySelector(".hand"),s=l.querySelector(".sprite-back");if(!s)return void r.log("No back card");const i=l.querySelector(".card");i&&!i.classList.contains("transparent")&&await async function({document:e,settings:t,cardEl:n,list:r}){const a=parseInt(n.dataset.card),c=e.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,l=c.querySelector(".card-flip"),s=E(a,e.querySelector("#card"));s.classList.add("card-face");const i=x(e);i.classList.add("card-face","card-face-back"),l.appendChild(s),l.appendChild(i),l.classList.remove("is-flipped"),r.appendChild(c),n.classList.add("transparent"),await(0,o.c)(t.discardAnimBeforeFlip),l.classList.add("is-flipped"),await(0,o.c)(t.discardAnimAfterFlip)}(Object.assign(e,{cardEl:i,list:l}));const d=s.parentElement,u=[];for(let e=0;e<Math.min(a,n.shuffleMaxCardsShow);++e){const e=x(t);e.classList.add("absolute","above","long-animation"),d.insertBefore(e,s),u.push(e)}const f=e=>k.A.randomInteger(-e,e,Math.random),g=()=>(0,o.c)(n.shuffleSmallDelay*Math.random());await g();for(let e=0;e<n.shuffleTimes;++e){for(const e of u)e.style.setProperty("--dx",f(150)),e.style.setProperty("--dy",f(170)),e.classList.add("slide"),await g();await(0,o.c)(n.shuffleOutDelay);for(const e of u)e.classList.remove("slide"),await g();await(0,o.c)(n.shuffleInDelay)}await(0,o.c)(n.shuffleWaitDelay);for(const e of u)e.remove();O(e)};async function A({document:e,fromEl:t,animTime:n,newCount:r,logger:a}){const c=e.querySelector(".center-pile").querySelector(".hand").querySelector(".sprite-back"),l=c.parentElement,s=x(e);s.classList.add("absolute","above"),l.insertBefore(s,c);const i=t.getBoundingClientRect().x-c.getBoundingClientRect().x,d=t.getBoundingClientRect().y-c.getBoundingClientRect().y,u=[{transform:`translate(calc(${i}px + 100%), ${d}px) scale(0)`},{transform:"translate(0, 0) scale(1)"}],f={duration:n,easing:"linear",fill:"forwards"};"function"==typeof s.animate&&(a.log("flipList",i,d),s.animate(u,f),await(0,o.c)(n/2)),t.textContent=r,await(0,o.c)(n/2),s.remove()}async function q({playerIndex:e,document:t,animTime:n,logger:r}){const a=t.querySelector(`[data-id="${e}"] .card-count`);if(!a)return void r.log("No element count",e);let o=parseInt(a.textContent);for(r.log("clearHandOther",e,o);o>0;--o)r.log("clear one",o),await A({document:t,fromEl:a,animTime:n,newCount:o-1,logger:r})}async function B({document:e,logger:t,settings:n,showAll:r},a){if(!a)return void t.log("No elem cleanHandMeOne");let c=1;r&&(c=4);const l=n.drawMy*c,s=e.querySelector(".center-pile").querySelector(".hand"),i=parseInt(a.dataset.card),d=e.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,u=d.querySelector(".card-flip"),f=E(i,e.querySelector("#card"));f.classList.add("card-face");const g=x(e);g.classList.add("card-face","card-face-back"),u.appendChild(f),u.appendChild(g),s.appendChild(d);const p=a.getBoundingClientRect().x-u.getBoundingClientRect().x,y=a.getBoundingClientRect().y-u.getBoundingClientRect().y;a.classList.add("transparent");const h=[{transform:`rotateY(0) translate(calc(${p}px + 100%), ${y}px)`},{transform:"rotateY(180deg)"}],m={duration:l,easing:"ease-in",fill:"forwards"};"function"==typeof u.animate&&(u.animate(h,m),t.log("animate cleanHandMeOne"),await(0,o.c)(l)),d.remove()}const R={clearHandOther:q,cleanHand:async function(e){const{logger:t,playerIndex:n,showAll:r,myIndex:a}=e;(n===a||r)&&(t.log("clearOpenHand",e),await async function(e){const{settings:t,document:n}=e,r=n.querySelector(`[data-id="${e.playerIndex}"] .hand`);for(const t of r.children)await B(e,t);await(0,o.c)(t.drawShow),r.replaceChildren()}(e)),t.log("before clearHandOther",e),await q(e)}};async function N({engine:e,hand:t,myIndex:n,logger:r,settings:a}){if(!e.isMyMove(n))return;const c=e.getCurrentSuitable();r.log("goodCards",c);let l=".js-draw";e.canDraw()||(l=".js-pass");const s=document.querySelector(l);0===c.length&&s&&s.classList.add("highlight-good");for(const e of t.children){const t=parseInt(e.dataset.card);c.includes(t)?e.classList.add("highlight-good"):e.classList.add("highlight-bad")}await(0,o.c)(a.highlightDelay);for(const e of t.children)e.classList.remove("highlight-good"),e.classList.remove("highlight-bad");s&&s.classList.remove("highlight-good")}let T=console;function M(e,t){return t.showAll||t.clickAll||e.showAllCards()}function G({document:e,engine:t,myIndex:n,settings:a,playersExternal:o}){e.documentElement.style.setProperty("--current-color",I(t.getCurrentColor()));const c=e.querySelector(".places");c.replaceChildren(),a.direction.includes("center")&&D(c,e,t);const l=e.createElement("ul");l.classList.add("circle-wrapper"),c.appendChild(l);const s=360/t.size();(0,r.v)(t.size()===o.length,"engine not equal to presenter "+JSON.stringify({e:t.size(),p:o.length}));const i=t.getPlayerIterator();let d=0;const u=t.getDealer(),f=t.getCurrentPlayer();for(const r of i){if(d===n){++d;continue}const c=90+s*(d-n),i=e.createElement("li");if(i.classList.add("js-player"),M(t,a)){if(L(e,i,r.pile(),a),a.clickAll){const e=d;i.addEventListener("click",(n=>{n.preventDefault();const r=n.target.parentElement;if(r&&r.classList.contains("card")){const n=parseInt(r.dataset.card);return t.moveToDiscard(e,n)}}))}}else{const t=e.createElement("div");t.textContent=r.pile().length,t.classList.add("card-count"),i.appendChild(t)}const g=e.createElement("div");g.classList.add("player-name");const p=o[d].name;g.textContent=p,i.appendChild(g);const y=r.getScore();if(y>0){const t=e.createElement("div");t.textContent=y,i.appendChild(t)}i.dataset.id=d,i.dataset.angle=c+"deg",i.style.setProperty("--angle-deg",c+"deg"),i.classList.add("circle"),f===d&&i.classList.add("current-player"),u===d&&i.classList.add("dealer"),++d,l.appendChild(i)}O({document:e,engine:t,settings:a,myIndex:n}),function({document:e,engine:t,myIndex:n,settings:r,playersExternal:a,logger:o},c){const l=t.getPlayerByIndex(n),s=e.createElement("div");s.classList.add("my-hand","js-player");const i=e.createElement("div");i.classList.add("row");const d=e.createElement("span"),u=a[n].name;d.textContent=u,d.classList.add("player-name"),i.appendChild(d);const f=l.getScore();if(f>0){const t=e.createElement("span");t.textContent=f,i.appendChild(t)}s.appendChild(i),s.dataset.id=n,t.getCurrentPlayer()===n&&s.classList.add("current-player"),t.getDealer()===n&&s.classList.add("dealer");const g=L(e,s,l.pile(),r);s.addEventListener("click",(async a=>{a.preventDefault();const c=a.target.parentElement;if(c&&c.classList.contains("card")){const a=parseInt(c.dataset.card);await t.moveToDiscard(n,a)||"aftermove"!==r.highlight||N({document:e,engine:t,hand:g,myIndex:n,logger:o,settings:r})}})),c.appendChild(s)}({document:e,engine:t,myIndex:n,settings:a,playersExternal:o,logger:T},c)}function _(e,t){t?T.log("drawPlayers",t):T.trace("drawPlayers",t),e.settings.legacyView?function({document:e,engine:t,myIndex:n,settings:r,playersExternal:a},o,c){e.documentElement.style.setProperty("--current-color",I(t.getCurrentColor()));const l=e.querySelector(".places");l.replaceChildren(),r.direction.includes("center")&&D(l,e,t);const s=e.createElement("ul");s.classList.add("circle-wrapper"),l.appendChild(s);const i=360/t.size(),d=t.getPlayerIterator(),u=t.getDealer(),f=t.getCurrentPlayer();o?c.log("Draw inner",o):c.log("Draw inner");let g=0;for(const t of d){const o=90+i*(g-n),c=e.createElement("li");c.classList.add("show-all");const l=e.createElement("span"),d=a[g].name;l.textContent=d,l.classList.add("player-name"),c.appendChild(l);const p=t.getScore();if(p>0){const t=e.createElement("span");t.textContent=p,c.appendChild(t)}L(e,c,t.pile(),r),c.dataset.id=g,c.dataset.angle=o+"deg",c.style.setProperty("--angle-deg",o+"deg"),c.classList.add("circle","player-hand","js-player"),u===g&&c.classList.add("dealer"),f===g&&c.classList.add("current-player"),s.appendChild(c),++g}O({document:e,engine:t,settings:r,myIndex:n}),s.addEventListener("click",(async e=>{e.preventDefault();const n=e.target.parentElement;if(n&&n.classList.contains("card")){const e=n.parentElement.parentElement,r=parseInt(n.dataset.card),a=parseInt(e.dataset.id);await t.moveToDiscard(a,r)}}))}(e,t,T):G(e)}async function H(e,t,n,r){const a=t.querySelector(".center-pile").querySelector(".hand"),c=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,l=c.querySelector(".card-flip"),s=t.querySelector("#card"),i=E(n,s);i.classList.add("card-face");const d=x(t);d.classList.add("card-face","card-face-back"),l.appendChild(i),l.appendChild(d),a.appendChild(c);const u=t.querySelector(".my-hand .hand"),f=E(n,s);f.classList.add("transparent"),u.appendChild(f);const g=[{transform:"rotateY(180deg)"},{transform:`rotateY(0) translate(calc(${f.getBoundingClientRect().x-l.getBoundingClientRect().x}px + 100%), ${f.getBoundingClientRect().y-l.getBoundingClientRect().y}px)`}],p={duration:r,easing:"ease-out",fill:"forwards"};"function"==typeof l.animate&&(l.animate(g,p),await(0,o.c)(r)),c.remove(),f.classList.remove("transparent")}async function j(e,t,n,r,a,c){if(!a)return void T.error("No target");const l=t.querySelector(".center-pile").querySelector(".hand"),s=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,i=s.querySelector(".card-flip"),d=E(n,t.querySelector("#card"));d.classList.add("card-face");const u=x(t);u.classList.add("card-face","card-face-back"),i.appendChild(d),i.appendChild(u),l.appendChild(s);const f=a.getBoundingClientRect(),g=[{transform:"rotateY(180deg)"},{transform:`rotateY(180deg) translate(calc(${-f.x+i.getBoundingClientRect().x-f.width/2}px), ${f.y-i.getBoundingClientRect().y+f.height/2}px) scale(0)`}],p={duration:r,easing:"ease-out",fill:"forwards"};"function"==typeof i.animate&&(i.animate(g,p),await(0,o.c)(r/2)),a.textContent=c,await(0,o.c)(r/2),s.remove()}async function U(e,t,n,r){const a=t.querySelector(".center-pile").querySelector(".hand"),c=parseInt(n.dataset.card,10),l=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,s=l.querySelector(".card-flip"),i=E(c,t.querySelector("#card"));i.classList.add("card-face");const d=x(t);d.classList.add("card-face","card-face-back"),s.appendChild(i),s.appendChild(d),a.appendChild(l);const u=n.getBoundingClientRect().x-s.getBoundingClientRect().x,f=n.getBoundingClientRect().y-s.getBoundingClientRect().y;n.classList.add("transparent");const g=[{transform:`translate(calc(${u}px + 100%), ${f}px)`},{transform:"translate(0, 0)"}],p=[{},{width:"0%"}],y={duration:r,easing:"linear",fill:"forwards"};"function"==typeof s.animate&&(s.animate(g,y),n.animate(p,y),await(0,o.c)(r));b(c,a.querySelector(".card")),n.remove(),l.remove()}async function $(e,t,n,r,a,c){const l=t.querySelector(".center-pile").querySelector(".hand"),s=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,i=s.querySelector(".card-flip"),d=E(a,t.querySelector("#card"));d.classList.add("card-face");const u=x(t);u.classList.add("card-face","card-face-back"),i.appendChild(d),i.appendChild(u),l.appendChild(s);const f=[{transform:`translate(calc(${n.getBoundingClientRect().x-i.getBoundingClientRect().x}px + 100%), ${n.getBoundingClientRect().y-i.getBoundingClientRect().y}px) scale(0)`},{transform:"translate(0, 0) scale(1)"}],g={duration:r,easing:"linear",fill:"forwards"};"function"==typeof i.animate&&(i.animate(f,g),await(0,o.c)(r/2)),n.textContent=c,await(0,o.c)(r/2);b(a,l.querySelector(".card")),s.remove()}function z(e,t,n,r){const a=t.querySelector(".my-hand .hand");return U(0,t,a.querySelector(`[data-card="${n}"]`),r)}const F={clearHandOther:R.clearHandOther,cleanHand:function(e){const t=M(e.engine,e.settings);return R.cleanHand(Object.assign(e,{showAll:t}))},drawPlayers:_,drawDiscard:async function({document:e,engine:t,myIndex:n,settings:r}){const a=e.querySelector(".center-pile").querySelector(".hand"),c=e.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,l=c.querySelector(".card-flip"),s=e.querySelector("#card"),i=E(t.getCardOnBoard(),s);i.classList.add("card-face");const d=x(e);d.classList.add("card-face","card-face-back"),l.appendChild(i),l.appendChild(d),a.appendChild(c),await(0,o.c)(r.discardAnimBeforeFlip),l.classList.remove("is-flipped"),await(0,o.c)(r.discardAnimAfterFlip),O({document:e,engine:t,settings:r,myIndex:n})},drawCurrent:function(e,t){const n=e.querySelectorAll(".js-player");for(const e of n){e.classList.remove("current-player","dealer");const n=parseInt(e.dataset.id);t.getCurrentPlayer()===n&&e.classList.add("current-player"),t.getDealer()===n&&e.classList.add("dealer")}if(t.getCurrentColor()){e.documentElement.style.setProperty("--current-color",I(t.getCurrentColor()));D(e.querySelector(".places"),e,t)}},drawDeal:H,drawPlayersDeal:function(e,{document:t,engine:n,myIndex:r,settings:a,playersExternal:o},c,l,s){if(!M(n,a)){if(s!==r){const e=t.querySelector(`[data-id="${s}"]`);let r=e.querySelector(".card-count");const o=n.getPlayerByIndex(s);return r||(r=t.createElement("div"),r.textContent=o.pile().length,r.classList.add("card-count"),e.appendChild(r)),j(0,t,l,a.moveAnim,r,o.pile().length)}return H(0,t,l,a.dealAnim)}_({document:t,engine:n,myIndex:r,settings:a,playersExternal:o},c)},drawMoveOther:$,drawDealOther:j,drawMoveByCard:z,drawMove:U,drawPlayersMove:function(e,{document:t,engine:n,myIndex:r,settings:a,playersExternal:o},c,l,s){if(M(n,a))return _({document:t,engine:n,myIndex:r,settings:a,playersExternal:o},c);if(s!==r){const e=t.querySelector(`[data-id="${s}"]`).querySelector(".card-count"),r=n.getPlayerByIndex(s);return $(0,t,e,a.moveOtherAnim,l,r.pile().length)}return z(0,t,l,a.moveAnim)},drawShuffle:P,setLogger:function(e){T=e}};var J=a(911);function W(e){if(0===e.length)return;return e.reduce(((e,t)=>y.cardScore(e)>y.cardScore(t)?e:t))}function V(e){(0,r.v)(e.length>0);const t={};for(const n of e)void 0===t[y.cardColor(n)]&&(t[y.cardColor(n)]=0),t[y.cardColor(n)]+=y.cardScore(n);let n,a=-1;for(const[e,r]of Object.entries(t))a<r&&(n=e,a=r);return(0,r.v)(n,e.map(y.cardToString)),(0,r.v)(y.GOOD_COLORS.includes(n),e.map(y.cardToString)),n}const K={findBestGoodCard:function(e,t,n){(0,r.v)(e.length>0,"findBestGoodCard on empty hand");const a=function(e,t,n){return(0,r.v)(y.matchColor(t,n),"Bad color "+JSON.stringify({pile:e,cardOnBoard:t,currentColor:n})+" "+y.cardToString(t)),e.filter((e=>y.sameColorOrTypeNonBlack(e,t,n)))}(e,t,n);return a.length>0?W(a):W(function(e,t,n){(0,r.v)(y.matchColor(t,n),"Bad color "+JSON.stringify({pile:e,cardOnBoard:t,currentColor:n})+" "+y.cardToString(t));const a=y.pileHasColor(e,n);return e.filter((e=>y.suitable(e,t,n,a)))}(e,t,n))},bestColor:function(e,t,n){(0,r.v)(e.includes(t),"Card not in hand");const a=y.cardColor(t);if(y.GOOD_COLORS.includes(a))return a;if(a===y.BLACK_COLOR){const t=e.filter((e=>y.cardColor(e)!==y.BLACK_COLOR));return t.length>0?V(t):n(y.GOOD_COLORS)}(0,r.v)(!1)},mostWeightedColor:V};function Y({players:e,engine:t,queue:n,logger:r,settings:a,rngEngine:c}){if(null==n)return void r.log("No queue - no bots");const l=[];let s=0;for(const t of e)t.is_bot&&l.push(s),++s;if(0===l.length)return void r.log("No bots, skipping");const i=function({engine:e,queue:t,logger:n,botIndexes:r,settings:a,rngEngine:c}){return{tryMove:l=>{if(l.gameState!==y.GameStage.ROUND)return void n.log("round not started yet");const s=e.getCurrentPlayer();if(l.currentPlayer!==s)return void n.error("best_card_bot bad player",s,l,l.currentPlayer);if(!r.includes(s))return void n.log("best_card_bot not bot",s);const i=e.getPlayerByIndex(s);if(i.hasEmptyHand())return void n.log("best_card_bot no cards",s);const d=(0,J.A)(e,n),u=e.secretlySeeTopCard(),f=t=>{const n=i.pile(),r=K.findBestGoodCard(n,e.getCardOnBoard(),e.getCurrentColor());let a,o,l=0;if(void 0===r)o={playerIndex:s,card:u},a=t>0?d.pass:d.draw;else{a=d.move;const e=e=>k.A.randomEl(e,c),t=K.bestColor(n,r,e);o={playerIndex:s,card:r,currentColor:t},++l}return async()=>(await a(o),l)};t.add((async()=>{await(0,o.c)(a.botMovePause),0===await f(0)()&&(await(0,o.c)(a.botSecondMovePause),await f(1)())}))}}}({engine:t,queue:n,logger:r,botIndexes:l,settings:a,rngEngine:c});t.on("changeCurrent",(e=>{i.tryMove(e)}))}function Q(e,t,n){let r=n&&n.state;r&&("object"==typeof r&&t.copy(r,t),e.state=()=>t.copy(t,{}))}class X{constructor(e){null==e&&(e=+new Date);let t=4022871197;function n(e){e=String(e);for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let r=.02519603282416938*t;t=r>>>0,r-=t,r*=t,t=r>>>0,r-=t,t+=4294967296*r}return 2.3283064365386963e-10*(t>>>0)}this.c=1,this.s0=n(" "),this.s1=n(" "),this.s2=n(" "),this.s0-=n(e),this.s0<0&&(this.s0+=1),this.s1-=n(e),this.s1<0&&(this.s1+=1),this.s2-=n(e),this.s2<0&&(this.s2+=1)}next(){let{c:e,s0:t,s1:n,s2:r}=this,a=2091639*t+2.3283064365386963e-10*e;return this.s0=n,this.s1=r,this.s2=a-(this.c=0|a)}copy(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}}function Z({window:e,document:t,settings:a},{playersExternal:c,myId:l,queue:s},i,d){const u=(0,n.A)(7,null,a),f=(0,n.A)(1,null,a),g=(0,n.A)(4,null,a),p=(0,n.A)(2,null,a),y=(0,n.A)(3,null,a);F.setLogger(p);const h=function(e,t){let n=new X(e),r=()=>n.next();return r.double=()=>r()+11102230246251565e-32*(2097152*r()|0),r.int32=()=>4294967296*n.next()|0,r.quick=r,Q(r,n,t),r}(a.seed),m=c.findIndex((e=>e.externalId===l));(0,r.v)(m>=0,"Not my game");const C=w({settings:a,rngFunc:h,applyEffects:a.applyEffects,delay:o.c},{logger:u,traceLogger:f,debugLogger:g},i);function S(e,t){if(t&&void 0!==t.playerIndex){const e=c[t.playerIndex];Object.assign(t,{externalId:e.externalId,myIndex:m})}return d[e](t)}function x(e){F.drawPlayers({document:t,engine:C,myIndex:m,settings:a,playersExternal:c},e)}function b(e,t){return t?a.drawShow:e===m?a.drawMy:a.drawClosed}C.on("draw",(({playerIndex:n,card:r})=>{F.drawPlayersDeal(e,{document:t,engine:C,myIndex:m,settings:a,playersExternal:c},"draw",r,n);const l=[(0,o.c)(b(n,C.showAllCards())),d.draw({playerIndex:n,card:r})];return Promise.all(l)})),C.on("drawExternal",(({playerIndex:n,card:r})=>{F.drawPlayersDeal(e,{document:t,engine:C,myIndex:m,settings:a,playersExternal:c},"drawExternal",r,n);const l=[(0,o.c)(b(n,C.showAllCards()))];return"server"===a.mode&&l.push(S("draw",{playerIndex:n,card:r})),Promise.all(l)})),C.on("changeCurrent",(e=>{F.drawCurrent(t,C,m,a);const n=[(0,o.c)(a.changeCurrentPause)];return"net"!==a.mode&&n.push(S("changeCurrent",e)),Promise.all(n)})),C.on("changeCurrentExternal",(()=>{F.drawCurrent(t,C,m,a);const e=[(0,o.c)(a.changeCurrentPause)];return Promise.all(e)})),C.on("pass",(e=>(e.playerIndex!==m&&u.error("Bad pass"),S("pass",e)))),C.on("move",(n=>{g.log("move",n),F.drawPlayersMove(e,{document:t,engine:C,myIndex:m,settings:a,playersExternal:c},"drawMove",n.card,n.playerIndex);const r=[(0,o.c)(a.movePause),S("move",n)];return Promise.all(r)})),C.on("discard",(async e=>{const n=F.drawDiscard({document:t,engine:C,myIndex:m,settings:a});await Promise.all([n,S("discard",e)])})),C.on("discardExternal",(e=>((0,r.v)(e===C.getCardOnBoard()),F.drawDiscard({document:t,engine:C,myIndex:m,settings:a})))),C.on("shuffle",(async e=>{g.log("new deck",e.length,...e);const n=[F.drawShuffle({document:t,settings:a,engine:C,myIndex:m,logger:p,length:e.length}),S("shuffle",e)];await Promise.all(n)})),C.on("shuffleFake",(e=>(u.log("new deck fake",e.length,e),F.drawShuffle({document:t,settings:a,engine:C,myIndex:m,logger:p,length:e.length})))),C.on("gameover",(async e=>{!function(e){x("onGameOver");const n=c[e.playerIndex].name,r=n+" wins",a="with score "+e.score;u.log(r,a),function(e,t,n){const r=e.querySelector(".overlay"),a=e.querySelector(".close"),o=e.querySelector(".install");a.addEventListener("click",(function(e){e.preventDefault(),r.classList.remove("show")}),!1),r.querySelector("h2").textContent=t,r.querySelector(".content").textContent=n,r.classList.add("show"),o.classList.remove("hidden2")}(t,r,a)}(e),await d.gameover(e)})),C.on("clearPlayer",(async e=>{const n=[d.clearPlayer(e)];n.push(F.cleanHand({playerIndex:e,myIndex:m,document:t,settings:a,engine:C,animTime:a.drawMy,logger:p})),await Promise.all(n)})),C.on("clearPlayerExternal",(()=>x("clearPlayerExternal"))),v(0,t,C,{inColorChoose:!1,inExternalMove:!1}),C.on("roundover",(async e=>{x("roundover"),"net"!==a.mode&&(await d.roundover(e),await(0,o.c)(a.betweenRounds),await C.nextDealer(),await(0,o.c)(a.beforeDeal),await C.deal())}));return Y({players:c,engine:C,queue:s,logger:y,settings:a,rngEngine:h}),d.engineCreated(C),x("firstDraw"),f.log("engineCreated"),(0,o.c)(100).then((()=>{const e=t.querySelector(".places");e&&e.classList.remove("connected","loading","flying-cards")})),{start:async function(){x("start"),a.chooseDealer&&(await(0,o.c)(a.beforeChooseDealer),await C.chooseDealer()),await(0,o.c)(a.betweenRounds),await C.deal()},getEngine:()=>C}}function ee(){}function te({window:e,document:a,settings:o,myId:c}){const l=(0,n.A)(8,null,o),s=(0,n.A)(2,null,o);(0,r.v)(c,"No id");const i=Object.fromEntries(["move","username","draw","pass","changeCurrent","discard","shuffle","clearPlayer","roundover","engineCreated","gameover","start"].map((e=>[e,ee])));let d,u,f=[],g=0,p=0;const h=o.maxClickToBan;let m=-1;const C=e=>{var t;m===e?++p:(m=e,p=1),p>=h&&(t=m,l.log("banPlayer "+t),f[t].banned=!0)};function w(){s.log("addBot"),++g;return S("bot "+g,"bot"+g,!0)}const v=()=>function(e,{onSeatsFinished:t,onSwap:n,onAddBot:r,onClick:a},o){const c=e.querySelector(".places");c.replaceChildren();const l=e.createElement("ul");l.classList.add("circle-wrapper"),c.appendChild(l);const s=360/o.filter((e=>!e.banned)).length;let i=90,d=null;l.addEventListener("click",(function(e){if(e.preventDefault(),e.target&&null!=e.target.dataset.id){if(a(parseInt(e.target.dataset.id)),d)return d.classList.remove("selected"),n(d.dataset.id,e.target.dataset.id),void(d=null);d=e.target,d.classList.add("selected")}}));for(let t=0;t<o.length;++t){const n=o[t];if(null==n){i+=s;continue}if(n.banned)continue;const r=e.createElement("li");r.innerText=o[t].name,r.dataset.id=t,r.dataset.angle=i+"deg",r.style.setProperty("--angle-deg",i+"deg"),r.classList.add("circle","clickable"),i+=s,l.appendChild(r)}{const n=e.createElement("button");n.textContent="Start",n.classList.add("start-button","clickable","flat-button"),n.addEventListener("click",(function(e){return e.preventDefault(),c.replaceChildren(),t()})),c.appendChild(n)}{const t=e.createElement("button");t.textContent="add bot",t.classList.add("bot-button","clickable","flat-button"),t.addEventListener("click",(function(e){return e.preventDefault(),r()})),c.appendChild(t)}}(a,{onSeatsFinished:D,onSwap:b,onAddBot:w,onClick:C},f);function S(e,t,n){(0,r.v)(e,"No name"),(0,r.v)(t,"No externalId");const a=f.findIndex((e=>e.externalId===t));return-1===a?f.push({name:e,externalId:t,is_bot:!!n}):f[a].name=e,v(),!0}const x=e=>(s.log("change name"),i.username({name:e,externalId:c}));function b(e,t){const n=f[e];return f[e]=f[t],f[t]=n,v()}function E(t){return Z({window:e,document:a,settings:o},{playersExternal:f,myId:c,queue:u},t,i)}const L=()=>({players:f,seed:o.seed,engine:d.getEngine().toJson()});async function D(){(0,r.v)(f.length>0,"No players"),o.seed?l.log("settings already set",o):(l.log("settings",o),o.seed=function(e){let t="";for(const n of e)t+=n.externalId;return t}(f)),f=f.filter((e=>!e.banned&&e.name)),s.log("after filter",f),d=E(function(e,t){return{playersRaw:function(e){const t=[];for(let n=0;n<e;++n)t.push({score:0,pile:[]});return t}(t),dealer:0,direction:1,deckRaw:[],discardPile:[],currentPlayer:0,gameState:y.GameStage.CHOOSE_DEALER,cardTaken:0,cardDiscarded:0,maxScore:e.maxScore||500}}(o,f.length)),s.log("Game init"),await i.start(L()),await d.start()}return{on:function(e,t){i[e]=t},join:S,canSeeGame:e=>null!=d&&(e=>{const t=f.find((t=>t.externalId===e));return void 0!==t&&!t.banned})(e),toJson:L,setQueue:e=>{u=e},onConnect:()=>t(e,a,o,x),onStart:e=>(f=e.players,o.seed=e.seed,d=E(e.engine),d),afterAllJoined:D,disconnect:e=>{if(null!=d)return!1;l.log("disconnect",e);const t=f.length;f=f.filter((t=>t.externalId!==e));const n=f.length;return v(),t>n},addBot:w}}function ne(e){switch(e.toLowerCase().trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}function re(e,t){e.includes("botCount")||"server"!==t.mode||(t.botCount=0)}(async function(t,n){const o={...e};let c;!function(e,t,n){const r=["mode","wh"];for(const n of r)if(e.includes(n))return void re(e,t);"https:"===n&&(t.mode="ai"),re(e,t)}(function(e,t){const n=new URLSearchParams(e),r=[];for(const[e,a]of n)"number"==typeof t[e]?t[e]=parseInt(a,10):"boolean"==typeof t[e]?t[e]=ne(a):t[e]=a,r.push(e);return r}(t.location.search,o),o,t.location.protocol),"net"===o.mode?c=await a.e(666).then(a.bind(a,666)):"server"===o.mode?c=await a.e(998).then(a.bind(a,998)):"ai"===o.mode?c=await a.e(723).then(a.bind(a,723)):"hotseat"===o.mode?c=await a.e(659).then(a.bind(a,659)):"test"===o.mode?c=await a.e(641).then(a.bind(a,641)):(0,r.v)(!1,"Unsupported mode"),c.default(t,n,o,te).catch((e=>{}))})(window,document)})()})();