(()=>{"use strict";var e,t,n={541:(e,t,n)=>{n.d(t,{A:()=>r});const r=function(e,t){return{move:n=>(t.log("onMove",n),e.onMove(n.playerIndex,n.card,n.currentColor)),draw:n=>(t.log("onDraw",n),e.onDraw(n.playerIndex,n.card))}}},911:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(541);const a=function(e,t){return Object.assign({},(0,r.A)(e,t),{pass:n=>(t.log("on pass",n),e.pass(n.playerIndex)),changeCurrent:()=>function(e){e.error("Should Not Happen")}(t)})}},217:(e,t,n)=>{function r(e,t){if(!e)throw t}n.d(t,{v:()=>r})},746:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(217);function a(e){const t={};for(const n of e)t[n]=[];const n=e=>{const n=t[e];return(0,r.v)(Array.isArray(n),"No key "+e),n};return{on:(e,t)=>n(e).push(t),set:(e,n)=>t[e]=n,setOnce:(e,n)=>{t[e]=[n]},call:(e,t)=>{const r=[];for(const a of n(e))"function"==typeof a&&r.push(a(t));return Promise.all(r)},reset:e=>{t[e]=[]},actionKeys:()=>Object.keys(t)}}},272:(e,t,n)=>{n.d(t,{A:()=>r});const r={makeId:function(e,t){let n="";const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let a=0;a<e;a++)n+=r.charAt(Math.floor(62*t()));return n},randomEl:function(e,t){return e[Math.floor(t()*e.length)]}}},158:(e,t,n)=>{n.d(t,{c:()=>r});const r=e=>new Promise((t=>setTimeout(t,e)))},42:(e,t,n)=>{function r(e,t,n){const r=e=>{t&&("object"==typeof e&&JSON&&JSON.stringify?t.innerHTML+=JSON.stringify(e)+"<br />":t.innerHTML+=e+"<br />")};return{log:(t,...a)=>{e<n.logLevel||r(t)},error:(t,...a)=>{e>=n.logLevel&&r(t)}}}n.d(t,{A:()=>r})}},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return n[e](o,o.exports,a),o.exports}a.m=n,a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,n)=>(a.f[n](e,t),t)),[])),a.u=e=>e+"."+{111:"b18fbb8174b3353df553",249:"6f6b3db364101d63dbeb",251:"24dbb0919ab2f3d7b789",433:"ab70fce1eef5b7148bb4",641:"5bf842ea05f649b56d32",659:"e86759edda98d5370874",666:"7ddb6374d5b19130a7c5",723:"115574f36cfa83cf5c81",998:"06d5d31bd57a178d3277"}[e]+".js",a.miniCssF=e=>{},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="suno:",a.l=(n,r,o,c)=>{if(e[n])e[n].push(r);else{var l,s;if(void 0!==o)for(var i=document.getElementsByTagName("script"),d=0;d<i.length;d++){var u=i[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+o){l=u;break}}l||(s=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",t+o),l.src=n),e[n]=[r];var f=(t,r)=>{l.onerror=l.onload=null,clearTimeout(p);var a=e[n];if(delete e[n],l.parentNode&&l.parentNode.removeChild(l),a&&a.forEach((e=>e(r))),t)return t(r)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=f.bind(null,l.onerror),l.onload=f.bind(null,l.onload),s&&document.head.appendChild(l)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={792:0};a.f.j=(t,n)=>{var r=a.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,a)=>r=e[t]=[n,a]));n.push(r[2]=o);var c=a.p+a.u(t),l=new Error;a.l(c,(n=>{if(a.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),c=n&&n.target&&n.target.src;l.message="Loading chunk "+t+" failed.\n("+o+": "+c+")",l.name="ChunkLoadError",l.type=o,l.request=c,r[1](l)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,o,[c,l,s]=n,i=0;if(c.some((t=>0!==e[t]))){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(s)s(a)}for(t&&t(n);i<c.length;i++)o=c[i],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0},n=self.webpackChunksuno=self.webpackChunksuno||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{const e={modes:["net","ai","server","hotseat"],mode:"net",connections:["webrtc","websocket"],connection:"websocket",wsPort:8088,loggerAnchor:".log",logLevel:7,cardsDeal:7,botCount:3,playerIsBot:!1,idNameInStorage:"my-id",idNameLen:6,maxClickToBan:5,maxScore:500,showAll:!1,clickAll:!1,show:!0,applyEffects:!0,lastCardNoColor:!0,colorOrder:["red","yellow","green","blue","black"],sortByColor:"",direction:["center"],seed:"",movePause:150,botMovePause:700,botSecondMovePause:300,dealAnim:500,discardAnimBeforeFlip:100,discardAnimAfterFlip:800,betweenRounds:900,beforeChooseDealer:100,drawShow:200,drawMy:120,drawClosed:50,beforeDeal:100,shufflePause:300,changeCurrentPause:50,moveAnim:250,maxNameLen:15};function t(e,t,n,r){const a=t.querySelector(".name-form-cont"),o=e.sessionStorage.getItem("username"),c=e=>{r&&"function"==typeof r&&r(e)};if(o)return a.replaceChildren(),void c(o);const l=t.querySelector("#nameform").content.cloneNode(!0).firstElementChild;a.replaceChildren(l);const s=t.querySelector(".nameform"),i=t.querySelector(".nameinput"),d=t.querySelector(".container");function u(t){(function(e){return!(e.length>n.maxNameLen&&(alert("Choose shorter name!"),1))})(i.value)&&(e.sessionStorage.setItem("username",t),c(t),s.classList.add("hidden"),d.classList.remove("hidden"),a.replaceChildren())}"net"===n.mode&&d.classList.add("hidden"),s.addEventListener("submit",(function(e){e.preventDefault(),u(i.value)}))}var n=a(42),r=a(217),o=a(158);function c(e,t,n){let r=e;function a(){return function(e,t){for(let n=e.length-1;n>0;n--){const r=Math.floor(t()*(n+1)),a=e[n];e[n]=e[r],e[r]=a}}(r,n),t(r)}return{deal:function(){return r.pop()},addCardAndShuffle:function(e){return function(e){r.push(e)}(e),a()},setDeck:function(e){r=e},checkTop:function(e){if(0===r.length)return!1;const t=r.at(-1)===e;return t},size:()=>r.length,shuffle:a,topCard:function(){if(0!==r.length)return r.at(-1)},toJson:()=>[...r]}}const l={newShuffledDeck:async function(e,t){const n=c(function(){const e=[...Array(112).keys()];return e.splice(56,1),e.splice(69,1),e.splice(82,1),e.splice(95,1),e}(),e,t);return await n.shuffle(),n},newExternalDeck:c},s=Object.freeze(["red","yellow","green","blue"]),i="black",d=Object.freeze({CHOOSE_DEALER:1,DEALING:2,ROUND:3,ROUND_OVER:4,GAME_OVER:5});function u(e){let t;if(e%14==13)return"black";switch(Math.floor(e/14)){case 0:case 4:t="red";break;case 1:case 5:t="yellow";break;case 2:case 6:t="green";break;case 3:case 7:t="blue"}return t}function f(e){switch(e%14){case 10:return"Skip";case 11:return"Reverse";case 12:return"Draw2";case 13:return Math.floor(e/14)>=4?"Draw4":"Wild";default:return"Number "+e%14}}function p(e){let t;switch(e%14){case 10:case 11:case 12:t=20;break;case 13:t=50;break;default:t=e%14}return t}function g(e,t,n){return u(e)===n||f(e)===f(t)}const y={GOOD_COLORS:s,BLACK_COLOR:i,GameStage:d,cardColor:u,cardType:f,cardScore:p,sortByTemplate:function(e,t,n){const r="asc"===t?1:-1;e.sort(((e,t)=>{const a=u(e),o=u(t);if(a===o){const n=p(e)-p(t);return 0===n?(e-t)*r:n*r}for(const e of n){if(e===a)return-1;if(e===o)return 1}return 0}))},pileHasColor:function(e,t){return null!=e.find((e=>u(e)===t))},cardToString:function(e){return u(e)+" "+f(e)},suitable:function(e,t,n,r){return"Wild"===f(e)||("Draw4"===f(e)?!r:g(e,t,n))},sameColorOrTypeNonBlack:function(e,t,n){return u(e)!==i&&g(e,t,n)},isDrawCard:function(e){return"Draw4"===f(e)||"Draw2"===f(e)},matchColor:function(e,t){return!!s.includes(t)&&(u(e)===t||u(e)===i)}};function m(e,t,n){const r=t,a=[...e];let o=n||0;const c=()=>[...a];return{toJson:()=>({score:o,pile:c()}),addCard:e=>a.push(e),pile:c,isUno:()=>1===a.length,getIndex:()=>r,cleanHand:()=>{a.length=0},removeCard:e=>{const t=a.indexOf(e);return t<0||a.splice(t,1),t},updateScore:e=>{o+=e},getScore:()=>o,setScore:e=>{o=e},hasEmptyHand:()=>0===a.length,hasColor:e=>y.pileHasColor(a,e),hasCard:e=>a.includes(e)}}var h=a(746);function C({settings:e,rngFunc:t,applyEffects:n},{logger:r,traceLogger:a,debugLogger:o},{playersRaw:c,dealer:s,direction:i,deckRaw:d,discardPile:u,currentPlayer:f,cardTaken:p,cardDiscarded:g,maxScore:C,gameState:w,cardOnBoard:S,currentColor:v}){const x=C,E=function(e){return(t,n)=>{if(!t)throw e.error(n),n}}(r),b=(0,h.A)(["shuffle","shuffleFake","draw","discard","discardExternal","move","clearPlayer","clearPlayerExternal","changeCurrent","changeCurrentExternal","changeDealer","gameover","roundover","pass","drawExternal","moveExternal"]);function L(e,t){return"changeCurrent"!==e||n||r.error("try to change current without effect"),b.call(e,t)}const D=e=>L("shuffle",e),O=c.map(((e,t)=>m(e.pile,t,e.score)));let P=l.newExternalDeck(d,D,t),k=I;function I(){return v}function B(e,t,n,r){return E(t>0,"Bad usage"),E(1===n||-1===n,"Bad usage direction"),(r+(e+1)*n+t)%t}function R(e,t,n){return B(0,t,n,e)}function q(){const e=u.pop();return P.setDeck(u),u=[e],P.shuffle()}async function A(e,t,a){if(null==e||0===e.size())return void r.error("deck is empty");const o=e.deal();if(null!=o)return O[t].addCard(o),a?await L("drawExternal",{playerIndex:t,card:o}):await L("draw",{playerIndex:t,card:o}),0===e.size()&&n&&(r.log("reshuffle discard"),await q()),o;r.error("deck is empty, should never happen")}function N(){return{[Symbol.iterator](){let e=0;return{next:()=>e>=O.length?{done:!0,value:e}:{done:!1,value:O[e++]},return:()=>(r.log("Closing"),{done:!0})}}}}function T(){f=R(f,O.length,i),p=0,g=0}async function G(e,t){E(t===f);const n=y.cardType(e);if(a.log("calcCardEffect",{playerIndex:t,card:e},y.cardToString(e)),"Reverse"===n&&(i*=-1,2===O.length&&T()),"Skip"===n&&T(),"Draw2"===n){T();for(let e=0;e<2;++e)await A(P,f)}if("Draw4"===n){T();for(let e=0;e<4;++e)await A(P,f)}await z()}async function M(e){E(e*O.length<P.size(),"Not enought cards to play");for(let t=0;t<e;++t){const e=O.length;for(let t=0;t<e;t++){const n=B(t,e,i,s),r=O[n].getIndex();await A(P,r)}}f!==s&&(r.error("dealN",F()),f=s,await L("changeCurrent",F()));const t=await async function(e){let t=e.deal();for(S=t;y.cardColor(t)===y.BLACK_COLOR;)await L("discard",t),S=void 0,await e.addCardAndShuffle(t),t=e.deal(),S=t;return u.push(t),v=y.cardColor(t),o.log("dealToDiscardEnd",F()),await L("discard",t),t}(P);await G(t,f),w=y.GameStage.ROUND}function _(){return O[f]}async function H(t,n){if(t!==f)return r.log("Wrong player",f,t),!1;if(!_().hasCard(n))return r.log("player not has card"),!1;if(w!==y.GameStage.ROUND)return r.log("start new round"),!1;if(g>0)return r.log("already moved"),!1;if("Wild"===y.cardType(n)){if(e.lastCardNoColor&&_().isUno())return v;const n=await k(t);return y.GOOD_COLORS.includes(n)?n:(r.error("Wrong color",n),!1)}if("Draw4"===y.cardType(n)){if(_().hasColor(v))return!1;if(e.lastCardNoColor&&_().isUno())return v;const n=await k(t);return y.GOOD_COLORS.includes(n)?n:(r.error("Wrong color",n),!1)}return y.cardColor(n)===v?v:y.cardType(n)===y.cardType(S)?y.cardColor(n):(r.error("Bad card",y.cardType(n),y.cardType(S),v),!1)}function j(){let e=0;const t=N();for(const n of t)for(const t of n.pile())e+=y.cardScore(t);return e}async function U(e){const t=O[e];E(t.hasEmptyHand(),"End on not empty hand"),E(w!==y.GameStage.ROUND,"Bad state onRoundEnd");const n=j();t.updateScore(n);const r=t.getScore();r>=x?(w=y.GameStage.GAME_OVER,await L("gameover",{playerIndex:e,score:r,diff:n})):(w=y.GameStage.ROUND_OVER,await L("roundover",{playerIndex:e,score:r,diff:n}))}async function $(e,t,a){const o=function(e,t,n){return e!==f?(r.error("Wrong player",f,e),!1):_().hasCard(t)?y.matchColor(t,n)?w!==y.GameStage.ROUND?(r.log("start new round",F()),!1):g>0?(r.log("already moved"),!1):!!y.suitable(t,S,v,_().hasColor(v))||(r.error("Bad card",y.cardType(t),y.cardType(S),v),!1):(r.error("Wrong next color",n,t,y.cardToString(t)),E(!1,"Bad color"),!1):(r.error("player not has card"),!1)}(e,t,a);return o&&await async function(e,t,r){E(w===y.GameStage.ROUND,"Move on round end");const a=O[e];a.removeCard(t),S=t,u.push(t),v=r,++g,a.hasEmptyHand()&&(w=y.GameStage.ROUND_OVER),await L("move",{playerIndex:e,card:t,currentColor:v}),n&&(await G(t,f),w!==y.GameStage.ROUND_OVER&&w!==y.GameStage.GAME_OVER||await U(e))}(e,t,a),o}async function z(){return T(),await L("changeCurrent",F()),!0}function F(){return{currentPlayer:f,dealer:s,direction:i,currentColor:v,cardOnBoard:S,gameState:w}}return{chooseDealer:function(){return async function(e){w=y.GameStage.CHOOSE_DEALER,P=await l.newShuffledDeck(D,e);let t=[...O];for(;t.length>1;){const e=t.length,n=new Array(e);let r=0;for(let o=0;o<e;o++){const c=B(o,e,i,s),l=t[c].getIndex(),d=await A(P,l);E(void 0!==d);const u=y.cardScore(d);a.log(">> Player "+o+" draws "+y.cardToString(d)+" and gets "+u+" points"),n[c]=u,r=Math.max(r,u)}const o=[];for(let a=0;a<e;a++)n[a]===r&&o.push(t[a]);t=o}t.length>=1?s=t[0].getIndex():r.error("No cand",t),f=s,w=y.GameStage.DEALING,await L("changeCurrent",F()),a.log("dealer was chosen",F())}(t)},deal:async function(){w=y.GameStage.DEALING,await async function(e){S=void 0,u=[];const t=[];for(const e of O)e.cleanHand(),t.push(L("clearPlayer",e.getIndex()));await Promise.allSettled(t),P=await l.newShuffledDeck(D,e)}(t),a.log("after cleanAllHands"),await M(e.cardsDeal),a.log("after dealN"),w=y.GameStage.ROUND,await L("changeCurrent",F())},getPlayerIterator:N,getPlayerByIndex:function(e){return O[e]},addPlayer:function(){return O.push(m(O.length)),!0},size:function(){return O.length},on:function(e,t){return b.on(e,t)},getDealer:function(){return s},getCurrentPlayer:function(){return f},getCardOnBoard:function(){return S},tryMove:H,moveToDiscard:async function(e,t){const n=await H(e,t);if(!1===n)return!1;const r=await $(e,t,n);return E(r,"Bad move"),r},setDeck:function(e){return null==P?P=l.newExternalDeck(e,D,t):P.setDeck(e),L("shuffleFake",e)},onDraw:async function(e,t){if(!P.checkTop(t))return r.error("Different engines"),!1;if(e!==f&&!y.isDrawCard(S)&&w!==y.GameStage.CHOOSE_DEALER&&w!==y.GameStage.DEALING)return r.error("draw not for current player",F()),!1;const n=await A(P,e,!0);return void 0===n?(r.error("onDraw bad"),!1):(a.log("onDraw",n,y.cardToString(n)),p++,!0)},onMove:async function(e,t,n){const a=await $(e,t,n);return a||r.log("Different engines"),a},onDiscard:async function(e){if(null==P||!P.checkTop(e))return void r.error("Different engines");const t=P.deal();E(t===e,"Different cards");const n=y.cardColor(e);n!==y.BLACK_COLOR?v=n:E(w!==y.GameStage.ROUND,"Black on discard in live round"),S=e,u.push(e),await L("discardExternal",e)},setCurrentObj:function(e){return p=0,g=0,E(void 0!==e.dealer,"No dealer"),E(void 0!==e.currentPlayer,"No currentPlayer"),E(e.direction,"No direction"),E(void 0!==e.gameState,"No gameState"),s=e.dealer,f=e.currentPlayer,i=e.direction,w=e.gameState,L("changeCurrentExternal",{})},cleanHandExternal:function(e){return S=void 0,u=[],O[e].cleanHand(),L("clearPlayerExternal",e)},nextDealer:function(){return i=1,s=R(s,O.length,i),f=s,w=y.GameStage.DEALING,L("changeCurrent",F())},onDrawPlayer:async function(e){if(e!==f)return r.log("draw not for current player",e,f),!1;if(w!==y.GameStage.ROUND)return r.log("onDrawPlayer bad state",F()),!1;if(p>0)return r.log("alreadyDrawn"),!1;const t=await A(P,f);return void 0===t?(r.error("onDrawPlayer bad"),!1):(p++,o.log("onDrawPlayer",t),null!=t)},pass:async function(e){return e!==f?(r.log("pass not for current player",e,f),!1):w!==y.GameStage.ROUND?(r.log("pass bad state",F()),!1):0==p?(r.error("cannot pass"),!1):(n?await z():await L("pass",{playerIndex:e}),!0)},getCurrentColor:I,getDirection:function(){return i},onEndRound:function(e){e.playerIndex!==f&&r.log("End not for current Player");const t=O[e.playerIndex];if(!t.hasEmptyHand())return r.error("End when not empty"),!1;const n=t.getScore();return e.score!==n+e.diff?(r.error("Bad score"),!1):j()!==e.diff?(r.error("Bad diff"),!1):(w=y.GameStage.ROUND_OVER,U(e.playerIndex))},deckSize:function(){return null==P?0:P.size()},secretlySeeTopCard:function(){if(null!=P)return P.topCard()},setColorChooser:e=>{k=e},toJson:()=>({playersRaw:O.map((e=>e.toJson())),deckRaw:P.toJson(),dealer:s,direction:i,discardPile:u,currentPlayer:f,gameState:w,cardTaken:p,cardDiscarded:g,maxScore:C,cardOnBoard:S,currentColor:v}),showAllCards:()=>w===y.GameStage.CHOOSE_DEALER,dealN:M}}function w(e,t,n,r){return n.setColorChooser((()=>function(e,t){return new Promise((n=>{t.inColorChoose=!0;const r=e.querySelector(".color-picker-holder");r.replaceChildren();const a=e.createElement("ul");a.classList.add("color-grid"),r.appendChild(a);for(const o of y.GOOD_COLORS){const c=e.createElement("li");c.classList.add(o),c.addEventListener("click",(e=>{e.preventDefault(),r.replaceChildren(),t.inColorChoose=!1,n(o)})),a.appendChild(c)}const o=e.createElement("li");o.classList.add("cancel-color"),o.addEventListener("click",(e=>{e.preventDefault(),r.replaceChildren(),t.inColorChoose=!1,n("black")})),a.appendChild(o)}))}(t,r))),{}}function S(e){const t=e.createElement("li");return t.classList.add("blank"),t}function v(e){return e.querySelector("#back").content.cloneNode(!0).firstElementChild}function x(e,t){return t.style.setProperty("--sprite-x",1400-e%14*100+"%"),t.style.setProperty("--sprite-y",800-100*Math.floor(e/14)+"%"),t.dataset.card=e,t}function E(e,t){return x(e,t.content.cloneNode(!0).firstElementChild)}async function b({document:e,fromEl:t,animTime:n,newCount:r,logger:a}){const c=e.querySelector(".center-pile").querySelector(".hand").querySelector(".sprite-back"),l=c.parentElement,s=v(e);s.classList.add("absolute","above"),l.insertBefore(s,c);const i=t.getBoundingClientRect().x-c.getBoundingClientRect().x,d=t.getBoundingClientRect().y-c.getBoundingClientRect().y,u=[{transform:`translate(calc(${i}px + 100%), ${d}px) scale(0)`},{transform:"translate(0, 0) scale(1)"}],f={duration:n,easing:"linear",fill:"forwards"};"function"==typeof s.animate&&(a.log("flipList",i,d),s.animate(u,f),await(0,o.c)(n/2)),t.textContent=r,await(0,o.c)(n/2),s.remove()}async function L({playerIndex:e,document:t,animTime:n,logger:r}){const a=t.querySelector(`[data-id="${e}"] .card-count`);let o=parseInt(a.textContent);for(;o>0;--o)r.log("clear one",o),await b({document:t,fromEl:a,animTime:n,newCount:o-1,logger:r})}async function D({document:e,logger:t,settings:n},r){if(!r)return void t.log("No elem cleanHandMeOne");const a=n.drawMy,c=e.querySelector(".center-pile").querySelector(".hand"),l=parseInt(r.dataset.card),s=e.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,i=s.querySelector(".card-flip"),d=E(l,e.querySelector("#card"));d.classList.add("card-face");const u=v(e);u.classList.add("card-face","card-face-back"),i.appendChild(d),i.appendChild(u),c.appendChild(s);const f=r.getBoundingClientRect().x-i.getBoundingClientRect().x,p=r.getBoundingClientRect().y-i.getBoundingClientRect().y;r.classList.add("transparent");const g=[{transform:`rotateY(0) translate(calc(${f}px + 100%), ${p}px)`},{transform:"rotateY(180deg)"}],y={duration:a,easing:"ease-in",fill:"forwards"};"function"==typeof i.animate&&(i.animate(g,y),await(0,o.c)(a)),s.remove()}const O={clearHandOther:L,cleanHand:function(e){return e.playerIndex===e.myIndex?async function(e){const t=document.querySelector(".my-hand .hand");for(const n of t.children)await D(e,n);t.replaceChildren()}(e):L(e)}};let P=console;function k(e,t){return t.showAll||t.clickAll||e.showAllCards()}function I(e,t,n,r,a){const o=e.createElement("ul"),c=e.querySelector("#card");o.classList.add("hand"),a&&a.sortByColor&&y.sortByTemplate(n,a.sortByColor,a.colorOrder);for(const e of n)o.appendChild(E(e,c));t.appendChild(o)}function B(e,t,n){q(n.size(),n.getDirection(),e,t,"big-circle")}function R(e,t,n,r,a){const o=e.querySelector(".places");let c=o.querySelector(".center-pile");c?c.replaceChildren():(c=e.createElement("div"),c.classList.add("center-pile"),o.appendChild(c)),function(e,t,n,r,a,o){const c=e.createElement("ul"),l=e.querySelector("#card");if(c.classList.add("hand"),null!=n?c.appendChild(E(n,l)):c.appendChild(S(e)),0===r.deckSize())c.appendChild(S(e));else{const t=v(e);t.addEventListener("click",(async e=>{e.preventDefault();let t=o;a&&(t=r.getCurrentPlayer()),await r.onDrawPlayer(t)||await r.pass(t)})),c.appendChild(t)}t.appendChild(c)}(e,c,t,n,r.clickAll,a)}function q(e,t,n,r,a,o){if(2===e||0===t)return;const c=n.querySelector("."+a);c&&c.remove();const l=r.createElement("span");l.classList.add(a);const s=r.createElement("div");s.classList.add("direction"),o&&s.classList.add(o),1===t&&s.classList.add("mirror"),l.appendChild(s),n.appendChild(l)}function A(e){const t={green:"rgba(85, 170, 85, 0.4)",red:"rgba(255, 85, 85, 0.4)",yellow:"rgba(255, 170, 0, 0.4)",blue:"rgba(85, 85, 255, 0.4)"}[e];return null!=t?t:"rgba(240, 248, 255, 0.3)"}function N({document:e,engine:t,myIndex:n,settings:a,playersExternal:o}){e.documentElement.style.setProperty("--current-color",A(t.getCurrentColor()));const c=e.querySelector(".places");c.replaceChildren(),a.direction.includes("center")&&B(c,e,t);const l=e.createElement("ul");l.classList.add("circle-wrapper"),c.appendChild(l);const s=360/t.size();(0,r.v)(t.size()===o.length,"engine not equal to presenter "+JSON.stringify({e:t.size(),p:o.length}));const i=t.getPlayerIterator();let d=0;const u=t.getDealer(),f=t.getCurrentPlayer();for(const r of i){if(d===n){++d;continue}const c=90+s*(d-n),i=e.createElement("li");if(i.classList.add("js-player"),k(t,a))I(e,i,r.pile(),0,a);else{const t=e.createElement("div");t.textContent=r.pile().length,t.classList.add("card-count"),i.appendChild(t)}const p=e.createElement("div");p.classList.add("player-name");const g=o[d].name;p.textContent=g,i.appendChild(p);const y=r.getScore();if(y>0){const t=e.createElement("div");t.textContent=y,i.appendChild(t)}i.dataset.id=d,i.dataset.angle=c+"deg",i.style.setProperty("--angle-deg",c+"deg"),i.classList.add("circle"),f===d&&i.classList.add("current-player"),u===d&&i.classList.add("dealer"),++d,l.appendChild(i)}R(e,t.getCardOnBoard(),t,a,n),function({document:e,engine:t,myIndex:n,settings:r,playersExternal:a},o){const c=t.getPlayerByIndex(n),l=e.createElement("div");l.classList.add("my-hand","js-player");const s=e.createElement("div");s.classList.add("row");const i=e.createElement("span"),d=a[n].name;i.textContent=d,i.classList.add("player-name"),s.appendChild(i);const u=c.getScore();if(u>0){const t=e.createElement("span");t.textContent=u,s.appendChild(t)}r.direction&&r.direction.includes("hand")&&q(t.size(),t.getDirection(),s,e,"sprite-container"),l.appendChild(s),l.dataset.id=n,t.getCurrentPlayer()===n&&l.classList.add("current-player"),t.getDealer()===n&&l.classList.add("dealer"),I(e,l,c.pile(),0,r),l.addEventListener("click",(async e=>{e.preventDefault();const r=e.target.parentElement;if(r&&r.classList.contains("card")){const e=parseInt(r.dataset.card);await t.moveToDiscard(n,e)}})),o.appendChild(l)}({document:e,engine:t,myIndex:n,settings:a,playersExternal:o},c)}function T(e,t){t?P.log("drawPlayers",t):P.trace("drawPlayers",t),e.settings.clickAll?function({document:e,engine:t,myIndex:n,settings:r,playersExternal:a},o){e.documentElement.style.setProperty("--current-color",A(t.getCurrentColor()));const c=e.querySelector(".places");c.replaceChildren(),r.direction.includes("center")&&B(c,e,t);const l=e.createElement("ul");l.classList.add("circle-wrapper"),c.appendChild(l);const s=360/t.size(),i=t.getPlayerIterator(),d=t.getDealer(),u=t.getCurrentPlayer();o?P.log("Draw inner",o):P.log("Draw inner");let f=0;for(const t of i){const o=90+s*(f-n),c=e.createElement("li");c.classList.add("show-all");const i=e.createElement("span"),p=a[f].name;i.textContent=p,i.classList.add("player-name"),c.appendChild(i);const g=t.getScore();if(g>0){const t=e.createElement("span");t.textContent=g,c.appendChild(t)}I(e,c,t.pile(),0,r),c.dataset.id=f,c.dataset.angle=o+"deg",c.style.setProperty("--angle-deg",o+"deg"),c.classList.add("circle","player-hand","js-player"),d===f&&c.classList.add("dealer"),u===f&&c.classList.add("current-player"),l.appendChild(c),++f}R(e,t.getCardOnBoard(),t,r,n),l.addEventListener("click",(async e=>{e.preventDefault();const n=e.target.parentElement;if(n&&n.classList.contains("card")){const e=n.parentElement.parentElement,r=parseInt(n.dataset.card),a=parseInt(e.dataset.id);await t.moveToDiscard(a,r)}}))}(e,t):N(e)}async function G(e,t,n,r){const a=t.querySelector(".center-pile").querySelector(".hand"),c=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,l=c.querySelector(".card-flip"),s=t.querySelector("#card"),i=E(n,s);i.classList.add("card-face");const d=v(t);d.classList.add("card-face","card-face-back"),l.appendChild(i),l.appendChild(d),a.appendChild(c);const u=t.querySelector(".my-hand .hand"),f=E(n,s);f.classList.add("transparent"),u.appendChild(f);const p=[{transform:"rotateY(180deg)"},{transform:`rotateY(0) translate(calc(${f.getBoundingClientRect().x-l.getBoundingClientRect().x}px + 100%), ${f.getBoundingClientRect().y-l.getBoundingClientRect().y}px)`}],g={duration:r,easing:"ease-out",fill:"forwards"};"function"==typeof l.animate&&(l.animate(p,g),await(0,o.c)(r)),c.remove(),f.classList.remove("transparent")}async function M(e,t,n,r,a,c){if(!a)return void P.error("No target");const l=t.querySelector(".center-pile").querySelector(".hand"),s=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,i=s.querySelector(".card-flip"),d=E(n,t.querySelector("#card"));d.classList.add("card-face");const u=v(t);u.classList.add("card-face","card-face-back"),i.appendChild(d),i.appendChild(u),l.appendChild(s);const f=a.getBoundingClientRect(),p=[{transform:"rotateY(180deg)"},{transform:`rotateY(180deg) translate(calc(${-f.x+i.getBoundingClientRect().x-f.width/2}px), ${f.y-i.getBoundingClientRect().y+f.height/2}px) scale(0)`}],g={duration:r,easing:"ease-out",fill:"forwards"};"function"==typeof i.animate&&(i.animate(p,g),await(0,o.c)(r/2)),a.textContent=c,await(0,o.c)(r/2),s.remove()}async function _(e,t,n,r){const a=t.querySelector(".center-pile").querySelector(".hand"),c=parseInt(n.dataset.card,10),l=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,s=l.querySelector(".card-flip"),i=E(c,t.querySelector("#card"));i.classList.add("card-face");const d=v(t);d.classList.add("card-face","card-face-back"),s.appendChild(i),s.appendChild(d),a.appendChild(l);const u=n.getBoundingClientRect().x-s.getBoundingClientRect().x,f=n.getBoundingClientRect().y-s.getBoundingClientRect().y;n.classList.add("transparent");const p=[{transform:`translate(calc(${u}px + 100%), ${f}px)`},{transform:"translate(0, 0)"}],g=[{},{width:"0%"}],y={duration:r,easing:"linear",fill:"forwards"};"function"==typeof s.animate&&(s.animate(p,y),n.animate(g,y),await(0,o.c)(r));x(c,a.querySelector(".card")),n.remove(),l.remove()}async function H(e,t,n,r,a,c){const l=t.querySelector(".center-pile").querySelector(".hand"),s=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,i=s.querySelector(".card-flip"),d=E(a,t.querySelector("#card"));d.classList.add("card-face");const u=v(t);u.classList.add("card-face","card-face-back"),i.appendChild(d),i.appendChild(u),l.appendChild(s);const f=[{transform:`translate(calc(${n.getBoundingClientRect().x-i.getBoundingClientRect().x}px + 100%), ${n.getBoundingClientRect().y-i.getBoundingClientRect().y}px) scale(0)`},{transform:"translate(0, 0) scale(1)"}],p={duration:r,easing:"linear",fill:"forwards"};"function"==typeof i.animate&&(i.animate(f,p),await(0,o.c)(r/2)),n.textContent=c,await(0,o.c)(r/2);x(a,l.querySelector(".card")),s.remove()}function j(e,t,n,r){const a=t.querySelector(".my-hand .hand");return _(0,t,a.querySelector(`[data-card="${n}"]`),r)}const U={clearHandOther:O.clearHandOther,cleanHand:O.cleanHand,drawPlayers:T,drawDiscard:async function(e,t,n,r){const a=e.querySelector(".center-pile").querySelector(".hand"),c=e.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,l=c.querySelector(".card-flip"),s=e.querySelector("#card"),i=E(t.getCardOnBoard(),s);i.classList.add("card-face");const d=v(e);d.classList.add("card-face","card-face-back"),l.appendChild(i),l.appendChild(d),a.appendChild(c),await(0,o.c)(r.discardAnimBeforeFlip),l.classList.remove("is-flipped"),await(0,o.c)(r.discardAnimAfterFlip),R(e,t.getCardOnBoard(),t,r,n)},drawCurrent:function(e,t){const n=e.querySelectorAll(".js-player");for(const e of n){e.classList.remove("current-player","dealer");const n=parseInt(e.dataset.id);t.getCurrentPlayer()===n&&e.classList.add("current-player"),t.getDealer()===n&&e.classList.add("dealer")}if(t.getCurrentColor()){e.documentElement.style.setProperty("--current-color",A(t.getCurrentColor()));B(e.querySelector(".places"),e,t)}},drawDeal:G,drawPlayersDeal:function(e,{document:t,engine:n,myIndex:r,settings:a,playersExternal:o},c,l,s){if(!k(n,a)){if(s!==r){const e=t.querySelector(`[data-id="${s}"]`).querySelector(".card-count"),r=n.getPlayerByIndex(s);return M(0,t,l,a.moveAnim,e,r.pile().length)}return G(0,t,l,a.dealAnim)}T({document:t,engine:n,myIndex:r,settings:a,playersExternal:o},c)},drawMoveOther:H,drawDealOther:M,drawMoveByCard:j,drawMove:_,drawPlayersMove:function(e,{document:t,engine:n,myIndex:r,settings:a,playersExternal:o},c,l,s){if(k(n,a))return T({document:t,engine:n,myIndex:r,settings:a,playersExternal:o},c);if(s!==r){const e=t.querySelector(`[data-id="${s}"]`).querySelector(".card-count"),r=n.getPlayerByIndex(s);return H(0,t,e,a.moveAnim,l,r.pile().length)}return j(0,t,l,a.moveAnim)},setLogger:function(e){P=e}};var $=a(911),z=a(272);function F(e){if(0===e.length)return;return e.reduce(((e,t)=>y.cardScore(e)>y.cardScore(t)?e:t))}function J(e){(0,r.v)(e.length>0);const t={};for(const n of e)void 0===t[y.cardColor(n)]&&(t[y.cardColor(n)]=0),t[y.cardColor(n)]+=y.cardScore(n);let n,a=-1;for(const[e,r]of Object.entries(t))a<r&&(n=e,a=r);return(0,r.v)(n,e.map(y.cardToString)),(0,r.v)(y.GOOD_COLORS.includes(n),e.map(y.cardToString)),n}const W={findBestGoodCard:function(e,t,n){(0,r.v)(e.length>0,"findBestGoodCard on empty hand");const a=function(e,t,n){return(0,r.v)(y.matchColor(t,n),"Bad color "+JSON.stringify({pile:e,cardOnBoard:t,currentColor:n})+" "+y.cardToString(t)),e.filter((e=>y.sameColorOrTypeNonBlack(e,t,n)))}(e,t,n);return a.length>0?F(a):F(function(e,t,n){(0,r.v)(y.matchColor(t,n),"Bad color "+JSON.stringify({pile:e,cardOnBoard:t,currentColor:n})+" "+y.cardToString(t));const a=y.pileHasColor(e,n);return e.filter((e=>y.suitable(e,t,n,a)))}(e,t,n))},bestColor:function(e,t,n){(0,r.v)(e.includes(t),"Card not in hand");const a=y.cardColor(t);if(y.GOOD_COLORS.includes(a))return a;if(a===y.BLACK_COLOR){const t=e.filter((e=>y.cardColor(e)!==y.BLACK_COLOR));return t.length>0?J(t):n(y.GOOD_COLORS)}(0,r.v)(!1)},mostWeightedColor:J};function V({players:e,engine:t,queue:n,logger:r,settings:a,rngEngine:c}){if(null==n)return void r.log("No queue - no bots");const l=[];let s=0;for(const t of e)t.is_bot&&l.push(s),++s;if(0===l.length)return void r.log("No bots, skipping");const i=function({engine:e,queue:t,logger:n,botIndexes:r,settings:a,rngEngine:c}){return{tryMove:l=>{if(l.gameState!==y.GameStage.ROUND)return void n.log("round not started yet");const s=e.getCurrentPlayer();if(l.currentPlayer!==s)return void n.error("best_card_bot bad player",s,l,l.currentPlayer);if(!r.includes(s))return void n.log("best_card_bot not bot",s);const i=e.getPlayerByIndex(s);if(i.hasEmptyHand())return void n.log("best_card_bot no cards",s);const d=(0,$.A)(e,n),u=t=>{const n=i.pile(),r=W.findBestGoodCard(n,e.getCardOnBoard(),e.getCurrentColor());let a,o,l=0;if(void 0===r)o={playerIndex:s,card:e.secretlySeeTopCard()},a=t>0?d.pass:d.draw;else{a=d.move;const e=e=>z.A.randomEl(e,c),t=W.bestColor(n,r,e);o={playerIndex:s,card:r,currentColor:t},++l}return async()=>(await a(o),l)};t.add((async()=>{await(0,o.c)(a.botMovePause),0===await u(0)()&&(await(0,o.c)(a.botSecondMovePause),await u(1)())}))}}}({engine:t,queue:n,logger:r,botIndexes:l,settings:a,rngEngine:c});t.on("changeCurrent",(e=>{i.tryMove(e)}))}function K(e,t,n){let r=n&&n.state;r&&("object"==typeof r&&t.copy(r,t),e.state=()=>t.copy(t,{}))}class Y{constructor(e){null==e&&(e=+new Date);let t=4022871197;function n(e){e=String(e);for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let r=.02519603282416938*t;t=r>>>0,r-=t,r*=t,t=r>>>0,r-=t,t+=4294967296*r}return 2.3283064365386963e-10*(t>>>0)}this.c=1,this.s0=n(" "),this.s1=n(" "),this.s2=n(" "),this.s0-=n(e),this.s0<0&&(this.s0+=1),this.s1-=n(e),this.s1<0&&(this.s1+=1),this.s2-=n(e),this.s2<0&&(this.s2+=1)}next(){let{c:e,s0:t,s1:n,s2:r}=this,a=2091639*t+2.3283064365386963e-10*e;return this.s0=n,this.s1=r,this.s2=a-(this.c=0|a)}copy(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}}function Q({window:e,document:t,settings:a},{playersExternal:c,myId:l,queue:s},i,d){const u=(0,n.A)(7,null,a),f=(0,n.A)(1,null,a),p=(0,n.A)(4,null,a),g=(0,n.A)(20,null,a),y=(0,n.A)(3,null,a);U.setLogger(g);const m=function(e,t){let n=new Y(e),r=()=>n.next();return r.double=()=>r()+11102230246251565e-32*(2097152*r()|0),r.int32=()=>4294967296*n.next()|0,r.quick=r,K(r,n,t),r}(a.seed),h=c.findIndex((e=>e.externalId===l));(0,r.v)(h>=0,"Not my game");const S=C({settings:a,rngFunc:m,applyEffects:a.applyEffects},{logger:u,traceLogger:f,debugLogger:p},i);function v(e,t){if(t&&void 0!==t.playerIndex){const e=c[t.playerIndex];Object.assign(t,{externalId:e.externalId,myIndex:h})}return d[e](t)}function x(e){U.drawPlayers({document:t,engine:S,myIndex:h,settings:a,playersExternal:c},e)}function E(e,t){return t?a.drawShow:e===h?a.drawMy:a.drawClosed}S.on("draw",(({playerIndex:n,card:r})=>{U.drawPlayersDeal(e,{document:t,engine:S,myIndex:h,settings:a,playersExternal:c},"draw",r,n);const l=[(0,o.c)(E(n,S.showAllCards())),d.draw({playerIndex:n,card:r})];return Promise.allSettled(l)})),S.on("drawExternal",(({playerIndex:n,card:r})=>{U.drawPlayersDeal(e,{document:t,engine:S,myIndex:h,settings:a,playersExternal:c},"drawExternal",r,n);const l=[(0,o.c)(E(n,S.showAllCards()))];return"server"===a.mode&&l.push(v("draw",{playerIndex:n,card:r})),Promise.all(l)})),S.on("changeCurrent",(e=>{U.drawCurrent(t,S,h,a);const n=[(0,o.c)(a.changeCurrentPause)];return"net"!==a.mode&&n.push(v("changeCurrent",e)),Promise.allSettled(n)})),S.on("changeCurrentExternal",(()=>{U.drawCurrent(t,S,h,a);const e=[(0,o.c)(a.changeCurrentPause)];return Promise.allSettled(e)})),S.on("pass",(e=>(e.playerIndex!==h&&u.error("Bad pass"),v("pass",e)))),S.on("move",(n=>{p.log("move",n),U.drawPlayersMove(e,{document:t,engine:S,myIndex:h,settings:a,playersExternal:c},"drawMove",n.card,n.playerIndex);const r=[(0,o.c)(a.movePause),v("move",n)];return Promise.allSettled(r)})),S.on("discard",(async e=>{const n=U.drawDiscard(t,S,h,a);await Promise.allSettled([n,d.discard(e)])})),S.on("discardExternal",(e=>((0,r.v)(e===S.getCardOnBoard()),U.drawDiscard(t,S,h,a)))),S.on("shuffle",(async e=>{x("shuffle"),u.log("new deck",e.length,...e),await d.shuffle(e),await(0,o.c)(a.shufflePause)})),S.on("shuffleFake",(async e=>{x("shuffleFake"),u.log("new deck fake",e.length,e),await(0,o.c)(a.shufflePause)})),S.on("gameover",(async e=>{!function(e){x("onGameOver");const n=c[e.playerIndex].name,r=n+" wins",a="with score "+e.score;u.log(r,a),function(e,n){const r=t.querySelector(".overlay"),a=t.querySelector(".close"),o=t.querySelector(".install");a.addEventListener("click",(function(e){e.preventDefault(),r.classList.remove("show")}),!1),r.querySelector("h2").textContent=e,r.querySelector(".content").textContent=n,r.classList.add("show"),o.classList.remove("hidden2")}(r,a)}(e),await d.gameover(e)})),S.on("clearPlayer",(async e=>{const n=[d.clearPlayer(e)];n.push(U.cleanHand({playerIndex:e,myIndex:h,document:t,settings:a,animTime:a.drawMy,logger:g})),await Promise.all(n)})),S.on("clearPlayerExternal",(()=>x("clearPlayerExternal"))),w(0,t,S,{inColorChoose:!1,inExternalMove:!1}),S.on("roundover",(async e=>{x("roundover"),"net"!==a.mode&&(await d.roundover(e),await(0,o.c)(a.betweenRounds),await S.nextDealer(),await(0,o.c)(a.beforeDeal),await S.deal())}));return V({players:c,engine:S,queue:s,logger:y,settings:a,rngEngine:m}),d.engineCreated(S),x("firstDraw"),f.log("engineCreated"),(0,o.c)(100).then((()=>{const e=t.querySelector(".places");e&&e.classList.remove("connected","loading","flying-cards")})),{start:async function(){await(0,o.c)(a.beforeChooseDealer),await S.chooseDealer(),await(0,o.c)(a.betweenRounds),await S.deal()},getEngine:()=>S}}function X(){}function Z({window:e,document:a,settings:o,myId:c}){const l=(0,n.A)(8,null,o);(0,r.v)(c,"No id");const s=Object.fromEntries(["move","username","draw","pass","changeCurrent","discard","shuffle","clearPlayer","roundover","engineCreated","gameover","start"].map((e=>[e,X])));let i,d,u=[],f=0,p=0;const g=o.maxClickToBan;let m=-1;const h=e=>{var t;m===e?++p:(m=e,p=1),p>=g&&(t=m,l.log("banPlayer "+t),u[t].banned=!0)};function C(){l.log("addBot"),++f;return S("bot "+f,"bot"+f,!0)}const w=()=>function(e,{onSeatsFinished:t,onSwap:n,onAddBot:r,onClick:a},o){const c=e.querySelector(".places");c.replaceChildren();const l=e.createElement("ul");l.classList.add("circle-wrapper"),c.appendChild(l);const s=360/o.filter((e=>!e.banned)).length;let i=90,d=null;l.addEventListener("click",(function(e){if(e.preventDefault(),e.target&&null!=e.target.dataset.id){if(a(parseInt(e.target.dataset.id)),d)return d.classList.remove("selected"),n(d.dataset.id,e.target.dataset.id),void(d=null);d=e.target,d.classList.add("selected")}}));for(let t=0;t<o.length;++t){const n=o[t];if(null==n){i+=s;continue}if(n.banned)continue;const r=e.createElement("li");r.innerText=o[t].name,r.dataset.id=t,r.dataset.angle=i+"deg",r.style.setProperty("--angle-deg",i+"deg"),r.classList.add("circle","clickable"),i+=s,l.appendChild(r)}{const n=e.createElement("button");n.textContent="Start",n.classList.add("start-button","clickable","flat-button"),n.addEventListener("click",(function(e){return e.preventDefault(),c.replaceChildren(),t()})),c.appendChild(n)}{const t=e.createElement("button");t.textContent="add bot",t.classList.add("bot-button","clickable","flat-button"),t.addEventListener("click",(function(e){return e.preventDefault(),r()})),c.appendChild(t)}}(a,{onSeatsFinished:L,onSwap:x,onAddBot:C,onClick:h},u);function S(e,t,n){(0,r.v)(e,"No name"),(0,r.v)(t,"No externalId");const a=u.findIndex((e=>e.externalId===t));return-1===a?u.push({name:e,externalId:t,is_bot:!!n}):u[a].name=e,w(),!0}const v=e=>(l.log("change name"),s.username({name:e,externalId:c}));function x(e,t){const n=u[e];return u[e]=u[t],u[t]=n,w()}function E(t){return Q({window:e,document:a,settings:o},{playersExternal:u,myId:c,queue:d},t,s)}const b=()=>({players:u,seed:o.seed,engine:i.getEngine().toJson()});async function L(){(0,r.v)(u.length>0,"No players"),o.seed?l.log("settings already set",o):(l.log("settings",o),o.seed=function(e){let t="";for(const n of e)t+=n.externalId;return t}(u)),u=u.filter((e=>!e.banned&&e.name)),l.log("after filter",u),i=E(function(e,t){return{playersRaw:function(e){const t=[];for(let n=0;n<e;++n)t.push({score:0,pile:[]});return t}(t),dealer:0,direction:1,deckRaw:[],discardPile:[],currentPlayer:0,gameState:y.GameStage.CHOOSE_DEALER,cardTaken:0,cardDiscarded:0,maxScore:e.maxScore||500}}(o,u.length)),l.log("Game init"),await s.start(b()),await i.start()}return{on:function(e,t){s[e]=t},join:S,canSeeGame:e=>null!=i&&(e=>{const t=u.find((t=>t.externalId===e));return void 0!==t&&!t.banned})(e),toJson:b,setQueue:e=>{d=e},onConnect:()=>t(e,a,o,v),onStart:e=>(u=e.players,o.seed=e.seed,i=E(e.engine),i),afterAllJoined:L,disconnect:e=>{if(null!=i)return!1;l.log("disconnect",e);const t=u.length;u=u.filter((t=>t.externalId!==e));const n=u.length;return w(),t>n},addBot:C}}function ee(e){switch(e.toLowerCase().trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}(async function(t,n){const o={...e};let c;!function(e,t){const n=new URLSearchParams(e);for(const[e,r]of n)"number"==typeof t[e]?t[e]=parseInt(r,10):"boolean"==typeof t[e]?t[e]=ee(r):t[e]=r}(t.location.search,o),"net"===o.mode?c=await a.e(666).then(a.bind(a,666)):"server"===o.mode?c=await a.e(998).then(a.bind(a,998)):"ai"===o.mode?c=await a.e(723).then(a.bind(a,723)):"hotseat"===o.mode?c=await a.e(659).then(a.bind(a,659)):"test"===o.mode?c=await a.e(641).then(a.bind(a,641)):(0,r.v)(!1,"Unsupported mode"),c.default(t,n,o,Z).catch((e=>{}))})(window,document)})()})();