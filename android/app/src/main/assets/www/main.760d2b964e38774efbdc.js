(()=>{"use strict";var e,t,n={392:(e,t,n)=>{function r(e){e&&e.remove()}function a(e,t,n){e.logger&&n&&(n.innerHTML+="object"==typeof t?(JSON&&JSON.stringify?JSON.stringify(t):t)+"<br />":t+"<br />")}function o(e,t){t&&(t.innerHTML+="object"==typeof e?(JSON&&JSON.stringify?JSON.stringify(e):e)+"<br />":e+"<br />")}function c(e){switch(e.toLowerCase().trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}}function l(e,t,n){const r=e.location.search,a=new URLSearchParams(r);for(const[e,t]of a)"number"==typeof n[e]?n[e]=parseInt(t,10):"boolean"==typeof n[e]?n[e]=c(t):n[e]=t}n.d(t,{Bk:()=>l,Q$:()=>o,cM:()=>a,ew:()=>r,gw:()=>s,hu:()=>i});const s=e=>new Promise((t=>setTimeout(t,e)));function i(e,t){if(!e)throw t}},971:(e,t,n)=>{function r(e,t,n,r){const a=t.querySelector(".name-form-cont"),o=e.sessionStorage.getItem("username");if(o)return a.replaceChildren(),void(r&&r.username(o,"server"));const c=t.querySelector("#nameform").content.cloneNode(!0).firstElementChild;a.replaceChildren(c);const l=t.querySelector(".nameform"),s=t.querySelector(".nameinput"),i=t.querySelector(".container");"net"===n.mode&&i.classList.add("hidden"),l.addEventListener("submit",(function(t){var n;t.preventDefault(),n=s.value,e.sessionStorage.setItem("username",n),r&&r.username(n,"server"),l.classList.add("hidden"),i.classList.remove("hidden"),a.replaceChildren()}))}n.d(t,{Z:()=>r})}},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return n[e](o,o.exports,a),o.exports}a.m=n,a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,n)=>(a.f[n](e,t),t)),[])),a.u=e=>e+"."+{297:"19f6941c4105feaf1765",745:"53646f16348e6d5ea452",945:"6466e1705e9b6987ab7c",970:"3001a0b27388e184e57b"}[e]+".js",a.miniCssF=e=>{},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="fool:",a.l=(n,r,o,c)=>{if(e[n])e[n].push(r);else{var l,s;if(void 0!==o)for(var i=document.getElementsByTagName("script"),d=0;d<i.length;d++){var u=i[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+o){l=u;break}}l||(s=!0,(l=document.createElement("script")).charset="utf-8",l.timeout=120,a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",t+o),l.src=n),e[n]=[r];var f=(t,r)=>{l.onerror=l.onload=null,clearTimeout(p);var a=e[n];if(delete e[n],l.parentNode&&l.parentNode.removeChild(l),a&&a.forEach((e=>e(r))),t)return t(r)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=f.bind(null,l.onerror),l.onload=f.bind(null,l.onload),s&&document.head.appendChild(l)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&!e;)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={179:0};a.f.j=(t,n)=>{var r=a.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise(((n,a)=>r=e[t]=[n,a]));n.push(r[2]=o);var c=a.p+a.u(t),l=new Error;a.l(c,(n=>{if(a.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),c=n&&n.target&&n.target.src;l.message="Loading chunk "+t+" failed.\n("+o+": "+c+")",l.name="ChunkLoadError",l.type=o,l.request=c,r[1](l)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,o,[c,l,s]=n,i=0;if(c.some((t=>0!==e[t]))){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(s)s(a)}for(t&&t(n);i<c.length;i++)o=c[i],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0},n=self.webpackChunkfool=self.webpackChunkfool||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{const e={modes:["net","ai","server"],mode:"net",wsPort:8088,logger:!0,loggerInMode:".log",networkDebug:!0,cardsDeal:7,maxScore:500,showAll:!1,clickAll:!1,show:!0,externalId:"server",applyEffects:!0,colorOrder:["red","yellow","green","blue","black"],sortByColor:"",direction:["center"],seed:"",dealAnim:500,moveAnim:250};var t=a(971);function n(e,t,n,r,a){const o=t.querySelector(".places");o.replaceChildren();const c=t.createElement("ul");c.classList.add("circle-wrapper"),o.appendChild(c);const l=360/a.length;let s=90,i=null;c.addEventListener("click",(function(e){if(e.preventDefault(),e.target&&null!=e.target.dataset.id){if(i)return i.classList.remove("selected"),r.swap(i.dataset.id,e.target.dataset.id),void(i=null);i=e.target,i.classList.add("selected")}}));for(let e=0;e<a.length;++e){if(null==a[e]){s+=l;continue}const n=t.createElement("li");n.innerText=a[e].name,n.dataset.id=e,n.dataset.angle=s+"deg",n.style.setProperty("--angle-deg",s+"deg"),n.classList.add("circle","clickable"),s+=l,c.appendChild(n)}const d=t.createElement("button");d.textContent="Start",d.classList.add("start-button","clickable"),d.addEventListener("click",(function(e){e.preventDefault(),o.replaceChildren(),r.onSeatsFinished()})),o.appendChild(d)}var r=a(392);function o(e,t){for(let n=e.length-1;n>0;n--){const r=Math.floor(t()*(n+1)),a=e[n];e[n]=e[r],e[r]=a}}function c(e,t,n){let r=e;return{deal:function(){return r.pop()},addCardAndShuffle:function(e){return function(e){r.push(e)}(e),o(r,n),t.shuffle(r)},setDeck:function(e){r=e},checkTop:function(e){if(0===r.length)return!1;const t=r.at(-1)===e;return t},size:()=>r.length,shuffle:function(){return o(r,n),t.shuffle(r)}}}const l={newShuffledDeck:async function(e,t){const n=function(){const e=[...Array(112).keys()];return e.splice(56,1),e.splice(69,1),e.splice(82,1),e.splice(95,1),e}();return o(n,t),await e.shuffle(n),c(n,e,t)},newExternalDeck:c},s=["red","yellow","green","blue"];Object.freeze(s);function i(e){let t;if(e%14==13)return"black";switch(Math.floor(e/14)){case 0:case 4:t="red";break;case 1:case 5:t="yellow";break;case 2:case 6:t="green";break;case 3:case 7:t="blue"}return t}function d(e){switch(e%14){case 10:return"Skip";case 11:return"Reverse";case 12:return"Draw2";case 13:return Math.floor(e/14)>=4?"Draw4":"Wild";default:return"Number "+e%14}}function u(e){let t;switch(e%14){case 10:case 11:case 12:t=20;break;case 13:t=50;break;default:t=e%14}return t}const f={GOOD_COLORS:s,GameStage:Object.freeze({chooseDealer:1,dealing:2,round:3,gameOver:4}),cardColor:i,cardType:d,cardScore:u,sortByTemplate:function(e,t,n){const r="asc"===t?1:-1;e.sort(((e,t)=>{const a=i(e),o=i(t);if(a===o){const n=u(e)-u(t);return 0===n?(e-t)*r:n*r}for(const e of n){if(e===a)return-1;if(e===o)return 1}return 0}))},pileHasColor:function(e,t){return null!=e.find((e=>i(e)===t))},cardToString:function(e){return i(e)+" "+d(e)}};function p(e){}function y(e){}function h(e,t){(0,r.hu)(e,t)}const g={shuffle:y,deal:y,draw:y,discard:y,move:y,clearPlayer:y,changeCurrent:y,changeDealer:y,gameover:y,roundover:y,pass:p,drawExternal:p,moveExternal:p,chooseColor:O};let w=500,m=0,C=0,v=[],S=null,x=!0,b=null,L=[],E=null,D=null,P=0,k=0,q=!0;function O(){return D}function I(){return C}function B(e,t){return h(t>0,"Bad usage"),(e+C+t)%t}function N(e,t){return(m+(e+1)*C+t)%t}function T(){return b}function R(e){if(!e)return!1;const t=v.length;return v.push(function(e,t){const n=e,r=t,a=[];let o=0;return{getName:()=>n,addCard:e=>a.push(e),pile:()=>[...a],getIndex:()=>r,cleanHand:()=>{a.length=0},removeCard:e=>{const t=a.indexOf(e);return t<0||a.splice(t,1),t},updateScore:e=>{o+=e},getScore:()=>o,setScore:e=>{o=e},hasColor:e=>f.pileHasColor(a,e),hasCard:e=>a.includes(e)}}(e,t)),!0}async function A(e,t,n){if(null==e||0===e.size())return null;const r=e.deal();return null==r?null:(v[t].addCard(r),n?await async function(e,...t){const n=g[e];if("function"==typeof n)return await n(...t)}("drawExternal",{playerIndex:t,card:r}):await g.draw({playerIndex:t,card:r}),0===e.size()&&await function(){const e=L.pop();return S.setDeck(L),L=[e],S.shuffle()}(),r)}async function M(e,t){if(!S.checkTop(t))return!1;await A(S,e,!0);return P++,!0}async function j(e){if(e!==E)return!1;if(q)return!1;if(P>0)return!1;P++;return null!=await A(S,E)}async function $(e){if(e===E){if(q)return!1;if(0!=P)return await ae(),await g.pass({playerIndex:e}),!0}}async function z(e,t,n){const r=await async function(e,t,n){const r=await function(e,t,n){if(e!==E)return!1;if(!Q().hasCard(t))return!1;if(!f.GOOD_COLORS.includes(n))return!1;if(q)return!1;if(k>0)return!1;if("Wild"===f.cardType(t))return!0;if("Draw4"===f.cardType(t))return!Q().hasColor(D);if(f.cardColor(t)!==n)return!1;if(f.cardColor(t)===D)return!0;if(f.cardType(t)===f.cardType(b))return!0;return!1}(e,t,n);r&&(v[e].removeCard(t),b=t,L.push(t),D=n,++k,await g.moveExternal({playerIndex:e,card:t,currentColor:D}),x&&(await Z(t,E),await te(e)));return r}(e,t,n);return r}async function H(e){if(null==S||!S.checkTop(e))return;h(S.deal()===e,"Different cards"),b=e;const t=f.cardColor(e);"black"!==t&&(L.push(e),D=t),await g.discard(e)}function _(e,t){g[e]=t}function G(){return{[Symbol.iterator](){let e=0;return{next:()=>e>=v.length?{done:!0,value:e}:{done:!1,value:v[e++]},return:()=>({done:!0})}}}}function J(){return v.length}function F(){return m}function Y(){return E}async function W(e){b=null,L=[],v[e].cleanHand(),await g.clearPlayer(e)}function U(){E=B(E,v.length),P=0,k=0}async function Z(e,t){const n=f.cardType(e);if("Reverse"===n&&(C*=-1,2===v.length&&U()),"Skip"===n&&U(),"Draw2"===n){U();for(let e=0;e<2;++e)await A(S,E)}if("Draw4"===n){U();for(let e=0;e<4;++e)await A(S,E)}await ae()}async function K(e){for(let t=0;t<e;++t){const e=v.length;for(let t=0;t<e;t++){const n=N(t,e),r=v[n].getIndex();await A(S,r)}}const t=await async function(e){E=m,await g.changeCurrent({currentPlayer:E,dealer:m,direction:C});let t=e.deal();for(b=t;"black"===f.cardColor(t);)await g.discard(t),b=null,await e.addCardAndShuffle(t),t=e.deal(),b=t;return L.push(t),D=f.cardColor(t),await g.discard(t),q=!1,t}(S);E=m,await Z(t)}function Q(){return v[E]}function V(e){return v[e]}async function X(e,t){if(e!==E)return!1;if(!Q().hasCard(t))return!1;if(q)return!1;if(k>0)return!1;if("Wild"===f.cardType(t)){const t=await g.chooseColor(e);return!!f.GOOD_COLORS.includes(t)&&(D=t,!0)}if("Draw4"===f.cardType(t)){if(Q().hasColor(D))return!1;const t=await g.chooseColor(e);return!!f.GOOD_COLORS.includes(t)&&(D=t,!0)}return f.cardColor(t)===D||f.cardType(t)===f.cardType(b)}async function ee(e,t){const n=await X(e,t);if(n){v[e].removeCard(t),b=t,L.push(t);const n=f.cardColor(t);"black"!=n&&(D=n),++k,await g.move({playerIndex:e,card:t,currentColor:D}),x&&(await Z(t),await te(e))}return n}async function te(e){const t=v[e];if(0===t.pile().length){q=!0;const n=function(){let e=0;const t=G();for(const n of t)for(const t of n.pile())e+=f.cardScore(t);return e}();t.updateScore(n),t.getScore()>=w?await g.gameover({playerIndex:e,score:t.getScore(),diff:n}):await g.roundover({playerIndex:e,score:t.getScore(),diff:n})}}function ne(e){const t=v[e.playerIndex],n=t.getScore();P=0,k=0,q=!1,e.score==n+e.diff&&t.setScore(e.score)}function re(e){return e==E&&ae()}async function ae(){return U(),P=0,k=0,await g.changeCurrent({currentPlayer:E,dealer:m,direction:C}),!0}async function oe(){return C=1,m=B(m,v.length),E=m,q=!1,P=0,k=0,await g.changeCurrent({currentPlayer:E,dealer:m,direction:C})}async function ce(){if(q)return!1;P>0?await ae():(P++,await A(S,E))}function le(e,t,n){P=0,k=0,null!=t&&(m=t,q=!1),null!=n&&(C=n),E=e}function se(){return{currentPlayer:E,dealer:m,currentColor:D,cardOnBoard:b,color:f.cardColor(b),type:f.cardType(b)}}function ie(){return null==S?0:S.size()}function de(e,t){return w=500,m=0,C=1,v=[],S=null,x=!0,b=null,L=[],E=null,D=null,P=0,k=0,q=!0,x=e.applyEffects,e.maxScore&&(w=e.maxScore),{chooseDealer:function(){return async function(e){S=await l.newShuffledDeck(g,e);let t=[...v];for(;t.length>1;){const e=t.length,n=new Array(e);let r=0;for(let a=0;a<e;a++){const o=N(a,e),c=t[o].getIndex(),l=await A(S,c),s=f.cardScore(l);n[o]=s,r=Math.max(r,s)}const a=[];for(let o=0;o<e;o++)n[o]===r&&a.push(t[o]);t=a}t.length>=1&&(m=t[0].getIndex()),E=m,await g.changeCurrent({currentPlayer:E,dealer:m,direction:C})}(t)},deal:async function(){return await async function(e){b=null,L=[];for(const e of v)e.cleanHand(),await g.clearPlayer(e.getIndex());S=await l.newShuffledDeck(g,e)}(t),K(e.cardsDeal)},dealN:K,getPlayerIterator:G,getPlayerByIndex:V,addPlayer:R,size:J,on:_,getDealer:F,getCurrentPlayer:Y,getCardOnBoard:T,tryMove:X,moveToDiscard:ee,drawCurrent:ce,setDeck:function(e){null==S?S=l.newExternalDeck(e,g,t):S.setDeck(e)},onDraw:M,onMove:z,onDiscard:H,setCurrent:le,cleanHand:W,nextDealer:oe,onDrawPlayer:j,pass:$,getCurrentColor:O,getDirection:I,state:se,onNewRound:ne,onPass:re,deckSize:ie}}function ue(e,t,n,r){return n.on("chooseColor",(()=>function(e,t){return new Promise((n=>{t.inColorChoose=!0;const r=e.querySelector(".color-picker-holder");r.replaceChildren();const a=e.createElement("ul");a.classList.add("color-grid"),r.appendChild(a);for(const o of f.GOOD_COLORS){const c=e.createElement("li");c.classList.add(o),c.addEventListener("click",(e=>{e.preventDefault(),r.replaceChildren(),t.inColorChoose=!1,n(o)})),a.appendChild(c)}const o=e.createElement("li");o.classList.add("cancel-color"),o.addEventListener("click",(e=>{e.preventDefault(),r.replaceChildren(),t.inColorChoose=!1,n("black")})),a.appendChild(o)}))}(t,r))),{}}function fe(e,t){return t.style.setProperty("--sprite-x",1400-e%14*100+"%"),t.style.setProperty("--sprite-y",800-100*Math.floor(e/14)+"%"),t.dataset.card=e,t}function pe(e,t){return fe(e,t.content.cloneNode(!0).firstElementChild)}function ye(e){const t=e.createElement("li");return t.classList.add("blank"),t}function he(e){return e.querySelector("#back").content.cloneNode(!0).firstElementChild}function ge(e,t,n,r,a){const o=e.createElement("ul"),c=e.querySelector("#card");o.classList.add("hand"),a&&a.sortByColor&&f.sortByTemplate(n,a.sortByColor,a.colorOrder);for(const e of n)o.appendChild(pe(e,c));t.appendChild(o)}function we(e,t,n){Ce(n.size(),n.getDirection(),e,t,"big-circle")}function me(e,t,n,r,a,o){const c=t.querySelector(".places");let l=c.querySelector(".center-pile");l?l.replaceChildren():(l=t.createElement("div"),l.classList.add("center-pile"),c.appendChild(l)),function(e,t,n,r,a,o){const c=e.createElement("ul"),l=e.querySelector("#card");if(c.classList.add("hand"),null!==n?c.appendChild(pe(n,l)):c.appendChild(ye(e)),0===r.deckSize())c.appendChild(ye(e));else{const t=he(e);t.addEventListener("click",(async e=>{e.preventDefault(),a?await r.drawCurrent():await r.onDrawPlayer(o)||await r.pass(o)})),c.appendChild(t)}t.appendChild(c)}(t,l,n,r,a.clickAll,o)}function Ce(e,t,n,r,a,o){if(2===e||0===t)return;const c=n.querySelector("."+a);c&&c.remove();const l=r.createElement("span");l.classList.add(a);const s=r.createElement("div");s.classList.add("direction"),o&&s.classList.add(o),1===t&&s.classList.add("mirror"),l.appendChild(s),n.appendChild(l)}function ve(e){const t={green:"rgba(85, 170, 85, 0.4)",red:"rgba(255, 85, 85, 0.4)",yellow:"rgba(255, 170, 0, 0.4)",blue:"rgba(85, 85, 255, 0.4)"}[e];return null!=t?t:"rgba(240, 248, 255, 0.3)"}function Se(e,t,n,r,a){t.documentElement.style.setProperty("--current-color",ve(n.getCurrentColor()));const o=t.querySelector(".places");o.replaceChildren(),a.direction.includes("center")&&we(o,t,n);const c=t.createElement("ul");c.classList.add("circle-wrapper"),o.appendChild(c);const l=360/n.size(),s=n.getPlayerIterator();let i=0;const d=n.getDealer(),u=n.getCurrentPlayer();let f=null;for(const e of s){if(i===r){f=e,++i;continue}const n=90+l*(i-r),o=t.createElement("li");if(o.classList.add("js-player"),a.show)ge(t,o,e.pile(),0,a);else{const n=t.createElement("div");n.textContent=e.pile().length,n.classList.add("card-count"),o.appendChild(n)}const s=t.createElement("div");s.classList.add("player-name"),s.textContent=e.getName(),o.appendChild(s);const p=e.getScore();if(p>0){const e=t.createElement("div");e.textContent=p,o.appendChild(e)}o.dataset.id=i,o.dataset.angle=n+"deg",o.style.setProperty("--angle-deg",n+"deg"),o.classList.add("circle"),u===i&&o.classList.add("current-player"),d===i&&o.classList.add("dealer"),++i,c.appendChild(o)}me(0,t,n.getCardOnBoard(),n,a,r),function(e,t,n,r,a,o,c){const l=t.createElement("div");l.classList.add("my-hand","js-player");const s=t.createElement("div");s.classList.add("row");const i=t.createElement("span");i.textContent=a.getName(),i.classList.add("player-name"),s.appendChild(i);const d=a.getScore();if(d>0){const e=t.createElement("span");e.textContent=d,s.appendChild(e)}c.direction&&c.direction.includes("hand")&&Ce(n.size(),n.getDirection(),s,t,"sprite-container"),l.appendChild(s),l.dataset.id=r,n.getCurrentPlayer()===r&&l.classList.add("current-player"),n.getDealer()===r&&l.classList.add("dealer"),ge(t,l,a.pile(),0,c),l.addEventListener("click",(async e=>{e.preventDefault();const t=e.target.parentElement;if(t&&t.classList.contains("card")){const e=parseInt(t.dataset.card);await n.moveToDiscard(r,e)}})),o.appendChild(l)}(0,t,n,r,f,o,a)}function xe(e,t,n,r,a,o){a.clickAll?function(e,t,n,r,a,o){t.documentElement.style.setProperty("--current-color",ve(n.getCurrentColor()));const c=t.querySelector(".places");c.replaceChildren(),a.direction.includes("center")&&we(c,t,n);const l=t.createElement("ul");l.classList.add("circle-wrapper"),c.appendChild(l);const s=360/n.size(),i=n.getPlayerIterator();let d=0;const u=n.getDealer(),f=n.getCurrentPlayer();for(const e of i){const n=90+s*(d-r),o=t.createElement("li");o.classList.add("show-all");const c=t.createElement("span");c.textContent=e.getName(),c.classList.add("player-name"),o.appendChild(c);const i=e.getScore();if(i>0){const e=t.createElement("span");e.textContent=i,o.appendChild(e)}ge(t,o,e.pile(),0,a),o.dataset.id=d,o.dataset.angle=n+"deg",o.style.setProperty("--angle-deg",n+"deg"),o.classList.add("circle","player-hand","js-player"),u===d&&o.classList.add("dealer"),f===d&&o.classList.add("current-player"),l.appendChild(o),++d}me(0,t,n.getCardOnBoard(),n,a,r),l.addEventListener("click",(async e=>{e.preventDefault();const t=e.target.parentElement;if(t&&t.classList.contains("card")){const e=t.parentElement.parentElement,r=parseInt(t.dataset.card),a=parseInt(e.dataset.id);await n.moveToDiscard(a,r)}}))}(0,t,n,r,a):Se(0,t,n,r,a)}async function be(e,t,n,a){const o=t.querySelector(".center-pile").querySelector(".hand"),c=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,l=c.querySelector(".card-flip"),s=t.querySelector("#card"),i=pe(n,s);i.classList.add("card-face");const d=he(t);d.classList.add("card-face","card-face-back"),l.appendChild(i),l.appendChild(d),o.appendChild(c);const u=t.querySelector(".my-hand .hand"),f=pe(n,s);f.classList.add("transparent"),u.appendChild(f);const p=[{transform:"rotateY(180deg)"},{transform:`rotateY(0) translate(calc(${f.getBoundingClientRect().x-l.getBoundingClientRect().x}px + 100%), ${f.getBoundingClientRect().y-l.getBoundingClientRect().y}px)`}],y={duration:a,easing:"ease-out",fill:"forwards"};l.animate(p,y),await(0,r.gw)(a),c.remove(),f.classList.remove("transparent")}async function Le(e,t,n,a,o,c){if(!o)return;const l=t.querySelector(".center-pile").querySelector(".hand"),s=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,i=s.querySelector(".card-flip"),d=pe(n,t.querySelector("#card"));d.classList.add("card-face");const u=he(t);u.classList.add("card-face","card-face-back"),i.appendChild(d),i.appendChild(u),l.appendChild(s);const f=[{transform:"rotateY(180deg)"},{transform:`rotateY(180deg) translate(calc(${-o.getBoundingClientRect().x+i.getBoundingClientRect().x-o.getBoundingClientRect().width/2}px), ${o.getBoundingClientRect().y-i.getBoundingClientRect().y+o.getBoundingClientRect().height/2}px) scale(0)`}],p={duration:a,easing:"ease-out",fill:"forwards"};i.animate(f,p),await(0,r.gw)(a/2),o.textContent=c,await(0,r.gw)(a/2),s.remove()}async function Ee(e,t,n,a){const o=t.querySelector(".center-pile").querySelector(".hand"),c=parseInt(n.dataset.card,10),l=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,s=l.querySelector(".card-flip"),i=pe(c,t.querySelector("#card"));i.classList.add("card-face");const d=he(t);d.classList.add("card-face","card-face-back"),s.appendChild(i),s.appendChild(d),o.appendChild(l);const u=n.getBoundingClientRect().x-s.getBoundingClientRect().x,f=n.getBoundingClientRect().y-s.getBoundingClientRect().y;n.classList.add("transparent");const p=[{transform:`translate(calc(${u}px + 100%), ${f}px)`},{transform:"translate(0, 0)"}],y={duration:a,easing:"linear",fill:"forwards"};s.animate(p,y),n.animate([{},{width:"0%"}],y),await(0,r.gw)(a);fe(c,o.querySelector(".card")),n.remove(),l.remove()}async function De(e,t,n,a,o,c){const l=t.querySelector(".center-pile").querySelector(".hand"),s=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,i=s.querySelector(".card-flip"),d=pe(o,t.querySelector("#card"));d.classList.add("card-face");const u=he(t);u.classList.add("card-face","card-face-back"),i.appendChild(d),i.appendChild(u),l.appendChild(s);const f=[{transform:`translate(calc(${n.getBoundingClientRect().x-i.getBoundingClientRect().x}px + 100%), ${n.getBoundingClientRect().y-i.getBoundingClientRect().y}px) scale(0)`},{transform:"translate(0, 0) scale(1)"}],p={duration:a,easing:"linear",fill:"forwards"};i.animate(f,p),await(0,r.gw)(a/2),n.textContent=c,await(0,r.gw)(a/2);fe(o,l.querySelector(".card")),s.remove()}function Pe(e,t,n,r){const a=t.querySelector(".my-hand .hand");return Ee(0,t,a.querySelector(`[data-card="${n}"]`),r)}const ke={drawCenter:me,drawPlayers:xe,drawLayout:Se,drawDiscard:async function(e,t,n,a,o){const c=t.querySelector(".center-pile").querySelector(".hand"),l=t.querySelector("#flip-card").content.cloneNode(!0).firstElementChild,s=l.querySelector(".card-flip"),i=t.querySelector("#card"),d=pe(n.getCardOnBoard(),i);d.classList.add("card-face");const u=he(t);u.classList.add("card-face","card-face-back"),s.appendChild(d),s.appendChild(u),c.appendChild(l),await(0,r.gw)(200),s.classList.remove("is-flipped"),await(0,r.gw)(800),me(0,t,n.getCardOnBoard(),n,o,a)},drawCurrent:function(e,t,n){const r=t.querySelectorAll(".js-player");for(const e of r){e.classList.remove("current-player","dealer");const t=parseInt(e.dataset.id);n.getCurrentPlayer()===t&&e.classList.add("current-player"),n.getDealer()===t&&e.classList.add("dealer")}if(n.getCurrentColor()){t.documentElement.style.setProperty("--current-color",ve(n.getCurrentColor()));we(t.querySelector(".places"),t,n)}},drawDeal:be,drawPlayersDeal:function(e,t,n,r,a,o,c,l){if(!a.show){if(l!=r){const e=t.querySelector(`[data-id="${l}"]`),r=n.getPlayerByIndex(l);return Le(0,t,c,a.moveAnim,e.querySelector(".card-count"),r.pile().length)}return be(0,t,c,a.dealAnim)}xe(0,t,n,r,a)},drawMoveOther:De,drawDealOther:Le,drawMoveByCard:Pe,drawMove:Ee,drawPlayersMove:function(e,t,n,r,a,o,c,l){if(a.show)return xe(0,t,n,r,a);if(l!=r){const e=t.querySelector(`[data-id="${l}"]`),r=n.getPlayerByIndex(l);return De(0,t,e.querySelector(".card-count"),a.moveAnim,c,r.pile().length)}return Pe(0,t,c,a.moveAnim)}};function qe(e,t,n){let r=n&&n.state;r&&("object"==typeof r&&t.copy(r,t),e.state=()=>t.copy(t,{}))}class Oe{constructor(e){null==e&&(e=+new Date);let t=4022871197;function n(e){e=String(e);for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let r=.02519603282416938*t;t=r>>>0,r-=t,r*=t,t=r>>>0,r-=t,t+=4294967296*r}return 2.3283064365386963e-10*(t>>>0)}this.c=1,this.s0=n(" "),this.s1=n(" "),this.s2=n(" "),this.s0-=n(e),this.s0<0&&(this.s0+=1),this.s1-=n(e),this.s1<0&&(this.s1+=1),this.s2-=n(e),this.s2<0&&(this.s2+=1)}next(){let{c:e,s0:t,s1:n,s2:r}=this,a=2091639*t+2.3283064365386963e-10*e;return this.s0=n,this.s1=r,this.s2=a-(this.c=0|a)}copy(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}}function Ie(e,t,n,a,o){const c=function(e,t){let n=new Oe(e),r=()=>n.next();return r.double=()=>r()+11102230246251565e-32*(2097152*r()|0),r.int32=()=>4294967296*n.next()|0,r.quick=r,qe(r,n,t),r}(n.seed),l=de(n,c);let s=0,i=0;function d(r){ke.drawPlayers(e,t,l,i,n,r)}for(const e of a)l.addPlayer(e.name),e.external_id==n.externalId&&(i=s),++s;function u(e,n){const r=t.getElementsByClassName("overlay")[0],a=t.getElementsByClassName("close")[0],o=t.getElementsByClassName("install")[0];a.addEventListener("click",(function(e){e.preventDefault(),r.classList.remove("show")}),!1);r.querySelector("h2").textContent=e;r.querySelector(".content").textContent=n,r.classList.add("show"),o.classList.remove("hidden2")}l.on("draw",(({playerIndex:a,card:c})=>{ke.drawPlayersDeal(e,t,l,i,n,"draw",c,a);const s=(0,r.gw)(150);let d=Promise.resolve();return a!==i&&"server"!==n.mode||(d=o.draw({playerIndex:a,card:c})),Promise.all([s,d])})),l.on("drawExternal",(({playerIndex:a,card:c})=>{ke.drawPlayersDeal(e,t,l,i,n,"drawExternal",c,a);const s=(0,r.gw)(150);let d=Promise.resolve();return"server"===n.mode&&(d=o.draw({playerIndex:a,card:c})),Promise.all([s,d])})),l.on("changeCurrent",(async({currentPlayer:a,dealer:c,direction:s})=>{ke.drawCurrent(e,t,l,i,n),"server"===n.mode&&await o.changeCurrent({currentPlayer:a,dealer:c,myIndex:i,direction:s}),await(0,r.gw)(50)})),l.on("pass",(async({playerIndex:e})=>{await o.pass({playerIndex:e,myIndex:i})})),l.on("move",(a=>{ke.drawPlayersMove(e,t,l,i,n,"drawExternal",a.card,a.playerIndex);const c=(0,r.gw)(150);let s=Promise.resolve();return a.playerIndex!==i&&"server"!==n.mode||(s=o.move(a)),Promise.all([c,s])})),l.on("moveExternal",(e=>{d("moveExternal");const t=(0,r.gw)(150);let a=Promise.resolve();return"server"===n.mode&&(a=o.move(e)),Promise.all([t,a])})),l.on("discard",(async r=>{const a=ke.drawDiscard(e,t,l,i,n);await Promise.all([a,o.discard(r)])})),l.on("shuffle",(async e=>{d("shuffle"),await o.shuffle(e),await(0,r.gw)(300)})),l.on("deal",(()=>{})),l.on("gameover",(async e=>{d();u(a[e.playerIndex].name+" wins","with score "+e.score),await o.gameover(e)})),l.on("clearPlayer",(async e=>{await o.clearPlayer(e),d()})),ue(0,t,l,{inColorChoose:!1,inExternalMove:!1}),l.on("roundover",(async e=>{"net"!==n.mode?(await o.roundover(e),await(0,r.gw)(1e3),await l.nextDealer(),await l.deal()):d()}));return{on:function(e,t){o[e]=t},start:async function(){await o.start({players:a,engine:l}),await l.chooseDealer(),await(0,r.gw)(700),n.showAll||n.clickAll?n.show=!0:n.show=!1,await l.deal()},onShuffle:async function(r){await l.setDeck(r),ke.drawPlayers(e,t,l,i,n)},onDraw:function(e,t){return l.onDraw(e,t)},onDiscard:function(e){return l.onDiscard(e)},onChangeCurrent:function(r){if(l.getCurrentPlayer()===r.myIndex||"server"!=n.mode)return n.showAll||n.clickAll?n.show=!0:n.show=!1,l.setCurrent(r.currentPlayer,r.dealer,r.direction),ke.drawCurrent(e,t,l,i,n)},onClearHand:function(e){return l.cleanHand(e)},onMove:function(e){return l.onMove(e.playerIndex,e.card,e.currentColor)},onNewRound:async function(e){const t=await l.onNewRound(e);return d(),t},onGameOver:function(e){return d(),u(a[e.playerIndex].name+" wins","with score "+e.score),!0},onPass:function(e){return l.onPass(e.playerIndex)},getEngine:()=>l}}function Be(e){}function Ne(){}function Te(e){let t="";for(const n of e)t+=n.external_id;return t}function Re(e,r,a){const o={move:Be,username:Be,draw:Ne,pass:Ne,changeCurrent:Be,discard:Ne,shuffle:Ne,clearPlayer:Be,roundover:Be,gameover:Be,start:Ne,swap:Ne,onSeatsFinished:Ne};let c=null,l=[];return{on:function(e,t){o[e]=t},onChange:function(e){if(null!=c)return c.onMove(e)},join:(e,t,a)=>(l[e]={name:t,external_id:a},n(0,r,0,o,l),!0),onConnect:()=>{(0,t.Z)(e,r,a,o)},swap:(e,t)=>{const a=l[e];l[e]=l[t],l[t]=a,n(0,r,0,o,l)},onStart:t=>{l=t,a.seed=Te(l),c=Ie(e,r,a,l,o);r.getElementsByClassName("places")[0].classList.remove("connected","loading","flying-cards")},afterAllJoined:async()=>{a.seed||(a.seed=Te(l)),c=Ie(e,r,a,l,o),await c.start()},onShuffle:e=>{if(null!=c)return c.onShuffle(e)},onDraw:(e,t)=>{if(null!=c)return c.onDraw(e,t)},onDiscard:e=>{if(null!=c)return c.onDiscard(e)},onNewRound:e=>{if(null!=c)return c.onNewRound(e)},onChangeCurrent:e=>{if(null!=c)return c.onChangeCurrent(e)},onClearHand:e=>{if(null!=c)return c.onClearHand(e)},onGameOver:e=>{if(null!=c)return c.onGameOver(e)},disconnect:e=>{if(null!=c)return!1;const t=l.length;l=l.filter((t=>t.external_id!=e));const a=l.length;return n(0,r,0,o,l),t>a},onPass:e=>{if(null!=c)return c.onPass(e)},actionKeys:()=>Object.keys(o),getHandlers:()=>o}}(async function(t,n){(0,r.Bk)(t,n,e);let o=null;"net"===e.mode?o=await a.e(970).then(a.bind(a,970)):"server"===e.mode?o=await a.e(745).then(a.bind(a,745)):"ai"===e.mode?o=await a.e(945).then(a.bind(a,945)):"test"===e.mode?o=await a.e(297).then(a.bind(a,297)):(0,r.hu)(!1,"Unsupported mode"),o.default(t,n,e,Re).catch((e=>{}))})(window,document)})()})();